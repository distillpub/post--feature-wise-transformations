<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link href="assets/style.css" type="text/css" rel="stylesheet">
    <script src="https://distill.pub/template.v2.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"
          integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0"
          crossorigin="anonymous">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <d-front-matter>
      <script type="text/json">{
        "title": "Understanding FiLM",
        "description": "Description of the post",
        "authors": [
          {
            "author": "Vincent Dumoulin",
            "authorURL": "https://vdumoulin.github.io",
            "affiliation": "Google Brain",
            "affiliationURL": "g.co/brain"
          },
          {
            "author": "Ethan Perez",
            "authorURL": "http://ethanperez.net/",
            "affiliation": "Rice University; MILA",
            "affiliationURL": "http://www.rice.edu/"
          },
          {
            "author": "Florian Strub",
            "authorURL": "https://fstrub95.github.io/",
            "affiliation": "Univ. of Lille, Inria",
            "affiliationURL": "https://team.inria.fr/sequel/"
          },
          {
            "author": "Harm de Vries",
            "authorURL": "http://www-etud.iro.umontreal.ca/~devries/",
            "affiliation": "MILA",
            "affiliationURL": "https://mila.quebec/en/"
          },
          {
            "author": "Nathan Schucher",
            "authorURL": "https://nathanschucher.com/",
            "affiliation": "Element AI",
            "affiliationURL": "https://element.ai/"
          },
          {
            "author": "Aaron Courville",
            "authorURL": "https://aaroncourville.wordpress.com/",
            "affiliation": "MILA",
            "affiliationURL": "https://mila.quebec/en/"
          },
          {
            "author": "Yoshua Bengio",
            "authorURL": "http://www.iro.umontreal.ca/~bengioy/yoshua_en/",
            "affiliation": "MILA",
            "affiliationURL": "https://mila.quebec/en/"
          }
        ]
      }</script>
    </d-front-matter>
  </head>
  <body>
    <d-title>
      <h1>Feature-wise transformations</h1>
      <p>A family of methods for fusing multiple sources of information</p>
    </d-title>
    <d-byline></d-byline>
    <d-article>


      <svg viewBox="0 0 0 0" style="display: none;" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <rect id="vector-patch-positive" width="30" height="30" rx="6" ry="6" opacity="0.8" style="fill: #80DEEA;"/>
          <rect id="vector-patch-negative" width="30" height="30" rx="6" ry="6" opacity="0.8" style="fill: #FFAB91;"/>
          <rect id="convolutional-patch-positive" width="20" height="20" rx="6" ry="6" opacity="0.8" style="fill: #80DEEA;"/>
          <rect id="convolutional-patch-negative" width="20" height="20" rx="6" ry="6" opacity="0.8" style="fill: #FFAB91;"/>

          <path id="arrow-left" d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z" transform="rotate(180, 0, 0)"/>
          <path id="arrow-right" d="M 0 0 C -2.779 1 -5.376 2.445 -7.69 4.28 L -6.14 0 L -7.69 -4.28 C -5.376 -2.445 -2.779 -1 0 0 Z"/>
          <path id="arrow-up" d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z"/>
          <path id="arrow-down" d="M 0 0 C 1 2.779 2.445 5.376 4.28 7.69 L 0 6.14 L -4.28 7.69 C -2.444 5.376 -1 2.770 0 0 Z" transform="rotate(180, 0, 0)"/>

          <path id="convolutional-feature" d="M 0 0 l 30 0 l 0 30 l -30 0 Z"/>
          <g id="vector-arrow">
            <path d="M 0 0 l 0 -16"/>
            <path d="M 0 -16 l -4 4 l 4 -4 l 4 4"/>
          </g>
          <g id="convolutional-arrow">
            <path d="M 0 0 L 0 -12"/>
            <path d="M -3 -9 L 0 -12 L 3 -9"/>
          </g>

          <path id="row-left" d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="row-middle" d="M 0 0 l 20 0 l 0 20 l -20 0 Z"/>
          <path id="row-right" d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -14 0 Z"/>
          <path id="big-row-left" d="M 0 6 a 6 6 0 0 1 6 -6 l 34 0 l 0 40 l -34 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="big-row-middle" d="M 0 0 l 40 0 l 0 40 l -40 0 Z"/>
          <path id="big-row-right" d="M 0 0 l 34 0 a 6 6 0 0 1 6 6 l 0 28 a 6 6 0 0 1 -6 6 l -34 0 Z"/>
          <path id="column-top" d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 14 l -20 0 Z"/>
          <path id="column-middle" d="M 0 0 l 20 0 l 0 20 l -20 0 Z"/>
          <path id="column-bottom" d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="matrix-top-left" d="M 0 6 a 6 6 0 0 1 6 -6 l 14 0 l 0 20 l -20 0 Z"/>
          <path id="matrix-top-right" d="M 0 0 l 14 0 a 6 6 0 0 1 6 6 l 0 14l -20 0 Z"/>
          <path id="matrix-bottom-left" d="M 0 0 l 20 0 l 0 20 l -14 0 a 6 6 0 0 1 -6 -6 Z"/>
          <path id="matrix-bottom-right" d="M 0 0 l 20 0 l 0 14 a 6 6 0 0 1 -6 6 l -14 0 Z"/>
          <path id="matrix-center" d="M 0 0 l 20 0 l 0 20 l -20 0 Z"/>
          <path id="singleton" d="M 0 6 a 6 6 0 0 1 6 -6 l 8 0 a 6 6 0 0 1 6 6 l 0 8 a 6 6 0 0 1 -6 6 l -8 0 a 6 6 0 0 1 -6 -6 Z"/>

          <path id="curly-brace-horizontal" d="M 0 0 C 0 -16 42.5 0 42.5 -16 C 42.5 0 85 -16 85 0"/>
          <path id="big-curly-brace-horizontal" d="M 0 0 C 0 -16 52.5 0 52.5 -16 C 52.5 0 105 -16 105 0"/>
          <path id="bigger-curly-brace-horizontal" d="M 0 0 C 0 -16 72.5 0 72.5 -16 C 72.5 0 145 -16 145 0"/>
          <path id="curly-brace-vertical" d="M 0 0 C 12 0 0 30 12 30 C 0 30 12 60 0 60"/>
          <path id="parenthesis-left" d="M 10 0 C -2 0 -2 80 10 80"/>
          <path id="parenthesis-right" d="M 0 0 C 8 0 8 80 0 80"/>
          <g id="pointer-icon">
            <circle cx="13.43" cy="13.43" r="12.93" fill="none" stroke="#ffdc8c" stroke-miterlimit="10"/>
            <circle cx="13.43" cy="13.43" r="10.38" fill="#ffb200"/>
            <polygon points="11.32 19.26 11.32 17.43 10.72 17.43 10.71 16.14 10.1 16.21 10.1 15 9.54 14.99 9.46 13.78 8.88 13.78 8.89 13.16 8.28 13.16 8.28 11.34 10.11 11.34 10.11 11.94 10.71 11.94 10.71 6.46 11.33 6.45 11.33 5.86 12.54 5.86 12.54 6.45 13.16 6.47 13.16 8.89 14.37 8.89 14.39 9.49 16.21 9.51 16.21 10.12 17.43 10.12 17.43 10.79 18.04 10.73 18.05 11.39 18.65 11.33 18.65 15.61 18.04 15.52 17.98 17.43 17.43 17.43 17.43 19.26 11.32 19.26" fill="#fff" opacity="0.2"/>
            <g>
              <path d="M10.11,11.94c0-.09,0-0.19,0-0.28s0-.21,0-0.32H8.28v1.82H8.89V11.95h1.23v0.63h0.6v0.6h0.61V13.09q0-2.4,0-4.8,0-.92,0-1.85h1.21V5.85H11.33v0.6H10.71v5.47h-0.6Zm4.28-2.44a0.45,0.45,0,0,1,0-.07c0-.15,0-0.3,0-0.45s0,0,0-.08H13.16V6.47H12.55v5.47h0.61V9.51h1.24s0,0.06,0,.09q0,1.12,0,2.25s0,0.07,0,.1H15V10.12h1.23v2.43h0.6V10.71l0.57,0s0,0,0,.05,0,0.29,0,.44,0,0.07,0,.11H18a0,0,0,0,1,.06.06c0,0.24,0,.48,0,0.72q0,1.71,0,3.41s0,0,0,.08h-0.6s0,0,0,0q0,0.86,0,1.72s0,0,0,.06H16.81v1.21H11.94V17.42H11.33V16.21h-0.6a11.4,11.4,0,0,0,0,1.22h0.6v1.83c2,0,4.07,0,6.11,0,0-.1,0-0.19,0-0.28,0-.46,0-0.93,0-1.39a1.53,1.53,0,0,0,0-.16H18c0.05,0,.07,0,0.07-0.07,0-.45,0-0.89,0-1.34,0-.13,0-0.26,0-0.4l0.3,0h0.3V11.33H18v-0.6H17.43V10.11H16.21V9.51H14.39ZM10.1,15v1.21h0.52a0.07,0.07,0,0,0,.08-0.08c0-.32,0-0.65,0-1,0-.06,0-0.11,0-0.17H10.11V13.77H9.49V13.16H8.91a2.7,2.7,0,0,0,0,.62H9.47s0,0,0,.07,0,0.27,0,.41,0,0.45,0,.68a0,0,0,0,0,.05.06H10.1Z" fill="#fff"/>
              <path d="M17.43,17.43s0,0,0-.06q0-.86,0-1.72s0,0,0,0H18s0-.06,0-0.08q0-1.71,0-3.41c0-.24,0-0.48,0-0.72A0,0,0,0,0,18,11.33H17.44s0-.07,0-0.11,0-.29,0-0.44,0-.05,0-0.05l-0.57,0v1.84h-0.6V10.12H15v1.82H14.38s0-.07,0-0.1q0-1.12,0-2.25s0-.06,0-0.09h1.81v0.6h1.22v0.62H18v0.6h0.61v4.28h-0.3l-0.3,0c0,0.14,0,.27,0,0.4,0,0.45,0,.89,0,1.34,0,0.05,0,.07-0.07.07H17.43Z" fill="#fff"/>
              <path d="M17.43,17.43a1.53,1.53,0,0,1,0,.16c0,0.46,0,.93,0,1.39,0,0.09,0,.17,0,0.28-2,0-4.06,0-6.11,0V17.43h-0.6a11.4,11.4,0,0,1,0-1.22h0.6v1.21h0.61v1.22h4.88V17.43h0.62Z" fill="#fff"/>
              <path d="M11.33,6.45q0,0.92,0,1.85,0,2.4,0,4.8v0.07H10.72v-0.6h-0.6V11.93h0.6V6.46h0.61Z" fill="#fff"/>
              <path d="M14.39,9.49H13.16v2.43H12.55V6.47h0.61V8.89h1.21s0,0.06,0,.08,0,0.3,0,.45a0.44,0.44,0,0,0,0,.07h0Z" fill="#fff"/>
              <path d="M10.1,15H9.54a0,0,0,0,1-.05-0.06c0-.23,0-0.45,0-0.68s0-.27,0-0.41,0,0,0-.07H8.88a2.7,2.7,0,0,1,0-.62H9.49v0.61h0.62V15h0.61c0,0.06,0,.12,0,0.17,0,0.32,0,.65,0,1a0.07,0.07,0,0,1-.08.08H10.1V15Z" fill="#fff"/>
              <path d="M10.11,11.93H8.89v1.21H8.28V11.34h1.83c0,0.11,0,.21,0,0.32s0,0.19,0,.28h0Z" fill="#fff"/>
              <path d="M11.33,6.45V5.85h1.21v0.6H11.33Z" fill="#fff"/>
            </g>
          </g>
        </defs>
      </svg>

      <p>
		some refer to this as multimodal learning, and refer to the
		consolidation of information from multiple modalities in a neural
		network as modality fusion.
		and require to discover the relationship between them.
		Some of these inputs, or modalities, may be complementary or redundant.
		For instance, the five senses can be thought as five modalities.
		However, retrieving accurate correlations between modalities is complex as 
		each modality may rely on different statistics or representations. 
		The problem is called multimodal learning, and refer to the
		consolidation of information from multiple modalities. 
		In the case of neural networks, the task often consists in
		learning a joint-embedding of the modalities (also call fusing mechanism).
      </p>
      <figure class="l-page-outset">
        <svg viewBox="0 0 900 280" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <filter x="0" y="0" width="1" height="1" id="zoolander-text-background">
              <feFlood flood-color="#fdf6f2"/>
              <feComposite in="SourceGraphic"/>
            </filter>
          </defs>
          <g transform="translate(100, 0)">
            <text x="0" y="210" class="figure-text">
              <tspan>
                A model is given access to both the video sequence and the audio
              </tspan>
              <tspan x="0" dy="1.5em">
                waveform of a movie scene and is asked to predict what is going on.
              </tspan>
              <tspan x="0" dy="2em" style="font-style: italic;">
                Credit: still frame taken from the movie Charade.
              </tspan>
            </text>
            <image x="0" y="0" height="182" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/charade.png"/>
            <path d="M 0 0 C 15 -50 27.5 -50 42.5 0 S 70 50 85 0 S 110.5 -50 127.5 0 S 155 50 170 0 S 197.5 -50 212.5 0 S 240 50 255 0 S 282.5 -50 297.5 0 S 325 50 340 0 S 367.5 -50 382.5 0 S 410 50 425 0" style="fill: none; stroke: #fdf6f2; stroke-width: 3px;" transform="scale(0.59) translate(10, 53)"/>
            <text filter="url(#zoolander-text-background)" x="130" y="30" dy="0.4em" style="opacity: 1; text-anchor: middle;" class="figure-text">"I'm having a nervous breakdown!"</text>
          </g>
          <g transform="translate(520, 0)">
            <text x="0" y="210" class="figure-text">
              <tspan>
                An image needs to be processed in the context of
              </tspan>
              <tspan x="0" dy="1.5em">
                a question being asked.
              </tspan>
              <tspan x="0" dy="2em" style="font-style: italic;">
                Credit: image-question pair taken from CLEVR.
              </tspan>
            </text>
            <image x="0" y="0" height="182" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/clevr_image.jpg"/>
            <text x="10" y="120" dy="0.4em" style="fill: white; opacity: 0.8; font-size: 10px;" class="figure-text">
              <tspan>Are there an equal</tspan>
              <tspan x="10" dy="1.5em">number of large</tspan>
              <tspan x="10" dy="1.5em">things and metal</tspan>
              <tspan x="10" dy="1.5em">spheres?</tspan>
            </text>
          </g>
        </svg>
      </figure>
      <p>
        We sometimes take a step further and assign a relationship between
        modalities; for instance, in the rightmost example above one could
        choose to extract meaning from the image <em>in the context of</em> the
        question being asked. We loosely refer to this as <em>conditioning</em>:
        the computation carried out by a neural network is <em>modulated</em> by
        information extracted from an auxiliary modality.
      </p>
      <p>
        Finding an effective and efficient way to achieve modality fusion or
        conditioning is a research problem which is relevant to many
        application areas, and as such many people are attacking it from many
        different perspectives. In this article, we concentrate on a specific
        family of approaches &mdash; which we propose to call
        <em>feature-wise transformations</em> &mdash; and examine their use in
        a surprisingly large number of neural network architectures to solve
        various problems. We will argue that these architectures can be
        understood from a multi-task learning perspective &mdash; where the
        conditioning signal is taken to be a task description &mdash; and that
        doing so gives rise to the notion of a <em>learned task representation</em>
        which allows to capture and leverage the relationship between these
        tasks.
      </p>

      <hr/>

      <h1>Feature-wise transformations</h1>
      <p>
        We begin with a data combination that is not typically considered
        multimodal: images and category labels. For the purpose of this example,
        we are interested in building a generative model of various classes of
        images (puppy, boat, airplane, etc.). The model takes a source of noise
        and a class as input and outputs an image sample for the requested
        class.
      </p>
      <figure class="l-body">
        <svg viewBox="0 0 648 170" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(490, 0)">
            <text x="0" y="10" dy="1em" class="figure-text">
              <tspan>
                The <tspan style="font-weight: bold;">decoder-based</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                <tspan style="font-weight: bold;">generative model</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                maps a source of
              </tspan>
              <tspan x="0" dy="1.5em">
                noise to a sample
              <tspan x="0" dy="1.5em">
                in the context of the
              </tspan>
              <tspan x="0" dy="1.5em">
                "puppy" class.
              </tspan>
            </text>
          </g>
          <g transform="translate(0, 0)">
            <text x="0" y="85" dy="0.4em" class="figure-text">noise</text>
            <path d="M 40 85 L 75 85" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(75, 85)" class="figure-path"/>
            <text x="155" y="10" style="text-anchor: middle;" class="figure-text">"puppy"</text>
            <path d="M 155 20 L 155 40" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(155, 40)" class="figure-path"/>
            <g transform="translate(80, 45)">
              <rect width="150" height="80" class="figure-group figure-box"/>
              <text x="75" y="40" dy="0.4em" style="text-anchor: middle;" class="figure-text">decoder</text>
            </g>
            <path d="M 230 85 L 300 85" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(300, 85)" class="figure-path"/>
            <image x="305" y="10" width="150" height="150" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/puppy.jpg"/>
          </g>
        </svg>
      </figure>
      <p>
        Our first instinct might be to build a separate model for every
        possible class. For a small number of classes this is not too bad a
        solution, but for thousands of classes we quickly run into scaling
        issues, because the number of parameters we need to train and store
        grows with the number of classes. We are also missing out on the
        opportunity to leverage commonalities between classes: for instance,
        different types of dogs (puppy, terrier, dalmatian, etc.) share common
        visual traits and are likely to share computation when mapping from the
        abstract noise vector to the output image.
      </p>
      <p>
        Now let's imagine that in addition to the various classes we also need
        to take into account attributes like size or color.  In that case, we
        can't reasonably expect to train a separate network for <em>all</em>
        possible conditioning values! Let's examine a few simple options.
      </p>
      <p>
        A quick fix would be to concatenate a representation of the
        conditioning information to the noise vector and treat the result as
        the model's input. This is very parameter-efficient &mdash; all we need
        to do is to increase the size of the first layer's weight matrix to
        accomodate the conditioning representation &mdash; but in doing so we
        make the implicit assumption that the input is where the model needs to
        take class information into account. Maybe this is the right
        assumption, or maybe it's not: it could be that the model does not need
        to take the class into account until late into the generation process,
        in which case we are forcing it to carry this information around
        unaltered for a long time.
      </p>
      <p>
        Because this is a cheap operation, we might as well avoid making any
        assumption and concatenate the conditioning representation to the input
        of <em>all</em> layers in the network. We propose to call this
        <em>concatenation-based conditioning</em>.
      </p>
      <figure class="l-body" id="concatenation-diagram">
        <svg viewBox="0 0 648 230" xmlns="http://www.w3.org/2000/svg">
          <text x="260" y="10" dy="1em" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Concatenation-based conditioning</tspan>
            </tspan>
            <tspan x="260" dy="1.5em">
              is implemented by <tspan style="font-weight: bold;">concatenating</tspan>
            </tspan>
            <tspan x="260" dy="1.5em">
              the conditioning representation to
            </tspan>
            <tspan x="260" dy="1.5em">
              the input.
            </tspan>
          </text>
          <text x="445" y="100" dy="0.4em" class="figure-text">
            <tspan>
              The result is passed
            </tspan>
            <tspan x="445" dy="1.5em">
              through a linear layer
            </tspan>
            <tspan x="445" dy="1.5em">
              to produce the output.
            </tspan>
          </text>
          <g transform="translate(10, 70)">
            <text x="0" y="90" dy="0.4em" class="figure-text">
              input
            </text>
            <g transform="translate(40, 60)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="191" y="-30" dy="-0.35em" style="text-anchor: end;" class="figure-text">
              <tspan>conditioning</tspan>
              <tspan x="191" dy="1.5em">representation</tspan>
            </text>
            <g transform="translate(201, -60)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
            </g>
            <g transform="translate(191, 30)">
              <rect width="40" height="120" class="figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">concatenate</text>
            </g>
            <g transform="translate(302, 30)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 80)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-filmed-network figure-element"/>
            </g>
            <g transform="translate(380, 30)">
              <rect width="40" height="120" class="figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">linear</text>
            </g>
            <g transform="translate(570, 50)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="600" y="90" dy="0.4em" class="figure-text">
              output
            </text>
            <path d="M 60 90 L 186 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(186, 90)" class="figure-path"/>
            <path d="M 231 90 L 297 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(297, 90)" class="figure-path"/>
            <path d="M 327 90 L 375 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(375, 90)" class="figure-path"/>
            <path d="M 420 90 L 565 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(565, 90)" class="figure-path"/>
            <path d="M 211 0 L 211 25" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(211, 25)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        Aside from concatenation, another efficient way to integrate class
        information into the network is via <em>biasing</em> of the hidden
        layers based on the conditioning representation &mdash; which is
        sometimes referred to as <em>conditional biasing</em>.
      </p>
      <figure class="l-body" id="conditional-biasing-diagram">
        <svg viewBox="0 0 648 300" xmlns="http://www.w3.org/2000/svg">
          <text x="330" y="30" dy="1em" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Conditional biasing</tspan>
              is implemented
            </tspan>
            <tspan x="330" dy="1.5em">
              by first mapping the <tspan style="font-weight: bold;">conditioning</tspan>
            </tspan>
            <tspan x="330" dy="1.5em">
              <tspan style="font-weight: bold;">representation</tspan>
              to a bias vector.
            </tspan>
          </text>
          <text x="330" y="200" dy="1em" class="figure-text">
            <tspan>
              The bias vector is then added to
            </tspan>
            <tspan x="330" dy="1.5em">
              the input.
            </tspan>
          </text>
          <g transform="translate(-20, 10)">
            <text x="20" y="250" dy="-0.5em" style="text-anchor: begin;" class="figure-text">input</text>
            <text x="605" y="250" dy="-0.5em" style="text-anchor: begin;" class="figure-text">output</text>
            <g transform="translate(60, 200)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <path d="M 80 240 L 300 240" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(300, 240)" class="figure-path"/>
            <g transform="translate(315, 240)">
              <circle r="10" class="figure-element"/>
              <path d="M -5 0 L 5 0" class="figure-line"/>
              <path d="M 0 -5 L 0 5" class="figure-line"/>
            </g>
            <path d="M 325 240 L 570 240" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(570, 240)" class="figure-path"/>
            <g transform="translate(575, 200)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="20" y="60" dy="-0.5em" style="font-weight: bold;" class="figure-text">
              <tspan>conditioning</tspan>
              <tspan x="20" dy="1.5em">representation</tspan>
            </text>
            <g transform="translate(170, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">linear</text>
            </g>
            <g transform="translate(305, 20)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 120 60  L 165 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(165, 60)" class="figure-path"/>
            <path d="M 210 60  L 300 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(300, 60)" class="figure-path"/>
            <path d="M 315 100 L 315 225" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(315, 225)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        It's interesting to note that conditional biasing is an equivalent way
        of implementing concatenation-based conditioning. To understand the
        equivalence, consider a simple fully-connected linear layer applied to
        the concatenation of an input <d-math>\mathbf{x}</d-math> and a
        conditioning representation <d-math>\mathbf{z}</d-math>.
        <d-footnote>
          The same argument applies to convolutional networks, provided we
          ignore the border effects due to zero-padding.
        </d-footnote>
      </p>
      <figure class="l-body-outset" id="concatenation-as-biasing">
        <svg viewBox="0 0 744 420" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 20)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                Concatenation-based conditioning
              </tspan>
              <tspan x="0" dy="1.5em">
                is equivalent to <tspan style="font-weight: bold;">conditional biasing</tspan>.
              </tspan>
            </text>
          </g>
          <g transform="translate(300, 20)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                We can decompose the matrix-
              </tspan>
              <tspan x="0" dy="1.5em">
                vector product into two matrix-
              </tspan>
              <tspan x="0" dy="1.5em">
                vector subproducts.
              </tspan>
            </text>
          </g>
          <g transform="translate(570, 20)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                The resulting two vectors
              </tspan>
              <tspan x="0" dy="1.5em">
                are added together. The <tspan style="font-weight: bold;">z</tspan>-
              </tspan>
              <tspan x="0" dy="1.5em">
                dependent vector can be
              </tspan>
              <tspan x="0" dy="1.5em">
                thought of as a conditional
              </tspan>
              <tspan x="0" dy="1.5em">
                bias.
              </tspan>
            </text>
          </g>
          <g transform="translate(60, 90)">
            <g transform="translate(-50, 100)">
              <g>
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 60)" class="figure-film-generator figure-element"/>
                <text x="60" y="90" dy="0.4em" style="text-anchor: middle;" class="figure-text">W</text>
              </g>
              <g transform="translate(125, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 0)" class="figure-line"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 60)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">x</text>
                <text x="45" y="90" dy="0.4em" style="font-weight: bold;" class="figure-text">z</text>
              </g>
            </g>
            <g transform="translate(240, 10)">
              <g>
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-filmed-network figure-element"/>
              </g>
              <g transform="translate(65, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 0)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">x</text>
              </g>
            </g>
            <g transform="translate(240, 240)">
              <g>
                <use xlink:href="#matrix-center" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(40, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(40, 60)" class="figure-film-generator figure-element"/>
              </g>
              <g transform="translate(65, 0)">
                <use xlink:href="#column-middle" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#curly-brace-vertical" transform="translate(25, 0)" class="figure-line"/>
                <text x="45" y="30" dy="0.4em" style="font-weight: bold;" class="figure-text">z</text>
              </g>
            </g>
            <g transform="translate(405, 10)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <g transform="translate(405, 240)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
            </g>
            <g transform="translate(565, 150)">
              <circle cx="10" cy="10" r="10" class="figure-element"/>
              <path d="M 10 5 l 0 10" class="figure-line"/>
              <path d="M 5 10 l 10 0" class="figure-line"/>
            </g>
            <g transform="translate(655, 120)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <path d="M 135 130 C 205 130 165 40 235 50" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(235, 50)" class="figure-path"/>
            <path d="M 135 190 C 205 190 165 290 235 280" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(235, 280)" class="figure-path"/>
            <path d="M 365 50 l 35 0" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(400, 50)" class="figure-path"/>
            <path d="M 365 280 l 35 0" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(400, 280)" class="figure-path"/>
            <path d="M 430 50 L 569 50 a 6 6 0 0 1 6 6 L 575 145" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(575, 145)" class="figure-path"/>
            <path d="M 430 280 L 569 280 a 6 6 0 0 0 6 -6 L 575 175" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(575, 175)" class="figure-path"/>
            <text x="435" y="295" class="figure-text">conditional bias</text>
            <path d="M 585 160 l 60 0" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(650, 160)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        Yet another efficient way to integrate class information into the
        network is via <em>scaling</em> of the hidden layers based on the
        conditioning representation. We refer to this as <em>conditional
        scaling</em>.
      </p>
      <figure class="l-body" id="conditional-biasing-diagram">
        <svg viewBox="0 0 648 300" xmlns="http://www.w3.org/2000/svg">
          <text x="330" y="30" dy="1em" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Conditional scaling</tspan>
              is implemented
            </tspan>
            <tspan x="330" dy="1.5em">
              by first mapping the <tspan style="font-weight: bold;">conditioning</tspan>
            </tspan>
            <tspan x="330" dy="1.5em">
              <tspan style="font-weight: bold;">representation</tspan>
              to a scaling vector.
            </tspan>
          </text>
          <text x="330" y="200" dy="1em" class="figure-text">
            <tspan>
              The scaling vector is then multiplied
            </tspan>
            <tspan x="330" dy="1.5em">
              with the input.
            </tspan>
          </text>
          <g transform="translate(-20, 10)">
            <text x="20" y="250" dy="-0.5em" style="text-anchor: begin;" class="figure-text">input</text>
            <text x="605" y="250" dy="-0.5em" style="text-anchor: begin;" class="figure-text">output</text>
            <g transform="translate(60, 200)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <path d="M 80 240 L 300 240" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(300, 240)" class="figure-path"/>
            <g transform="translate(315, 240)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 325 240 L 570 240" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(570, 240)" class="figure-path"/>
            <g transform="translate(575, 200)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="20" y="60" dy="-0.5em" style="font-weight: bold;" class="figure-text">
              <tspan>conditioning</tspan>
              <tspan x="20" dy="1.5em">representation</tspan>
            </text>
            <g transform="translate(170, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">linear</text>
            </g>
            <g transform="translate(305, 20)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 120 60  L 165 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(165, 60)" class="figure-path"/>
            <path d="M 210 60  L 300 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(300, 60)" class="figure-path"/>
            <path d="M 315 100 L 315 225" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(315, 225)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        A special instance of conditional scaling is feature-wise sigmoidal
        gating: each feature is scaled by a scalar between <d-math>0</d-math>
        and <d-math>1</d-math> as a function of the conditioning
        representation.  This constraint is often enforced via a sigmoidal
        layer, hence the name.  Intuitively, feature-wise sigmoidal gating
        allows the conditioning information to select which features are passed
        forward and which are zeroed out.
      </p>
      <p>
        Given that both additive and multiplicative interactions seem natural
        and intuitive, which one should we pick? One argument in favor of
        <em>multiplicative</em> interactions is that they are useful in learning
        relationships between inputs, as these interactions naturally identify
        "matches": elements with highly similar values (regardless of sign)
        will generally produce higher values when multiplied and lower values
        otherwise. This is why dot products are often used to determine how
        similar two vectors are.
        <d-footnote>
          Multiplicative interactions alone have had a history of success in
          various domains &mdash; see
          <a href="#bibliographic-notes">Bibliographic Notes</a>.
        </d-footnote>
        One argument in favor of <em>additive</em> interactions is that they
        are more natural fit for applications that are less strongly dependent
        on the joint values of two inputs, like feature aggregation or feature
        detection (i.e., checking if a feature is present in either of two
        inputs). In the spirit of making as few assumptions about the problem
        as possible, we might combine <em>both</em> into what we refer to as
        <em>conditional affine transformations</em>.
        <d-footnote>
          An affine transformation is a transformation of the form
          <d-math>y = m * x + b</d-math>.
        </d-footnote>
      </p>
      <p>
        All methods outlined above share the common trait that they act at the
        <em>feature</em> level; in other words, they leverage
        <em>feature-wise</em> interactions between the conditioning
        representation and the conditioned network. More complex forms of
        interactions are certainly possible, but in practice feature-wise
        interactions strike a happy compromise between effectiveness and
        efficiency: the number of scaling and/or shifting coefficients
        we need to predict to condition the network scales linearly with the
        total number of features in the network.
      </p>
      <h3>Nomenclature</h3>
      <p>
        To continue the discussion on feature-wise transformations we need to
        abstract away the distinction between multiplicative and additive
        interactions. Without losing generality, let's focus on feature-wise
        affine transformations, and let's adopt the nomenclature of Perez et
        al. <d-cite key="perez2018film"></d-cite>, which formalizes these
        transformations under the acronym <em>FiLM</em>, for Feature-wise
        Linear Modulation.
        <d-footnote>
          Strictly speaking, <em>linear</em> is a misnomer, as we allow biasing,
          but we hope the more rigorous-minded reader will forgive us for the
          sake of a better-sounding acronym.
        </d-footnote>
      </p>
      <p>
        We say that a neural network is modulated using FiLM, or
        <em>FiLM-ed</em>, through the insertion of <em>FiLM layers</em> in its
        architecture. These are parametrized by some form of conditioning
        information, and the mapping from conditioning information to FiLM
        parameters is called the <em>FiLM generator</em>. In other words, the
        FiLM generator predicts the parameters of the FiLM layers based on some
        arbitrary input.  For simplicity, you can assume that the FiLM generator
        outputs the concatenation of all FiLM parameters for the network
        architecture.
      </p>
      <figure class="l-body-outset" id="film-architecture-diagram">
        <svg viewBox="0 0 744 510" xmlns="http://www.w3.org/2000/svg">
          <text x="0" y="20" class="figure-text">
            <tspan>
              The <tspan style="font-weight: bold;">FiLM generator</tspan>
              processes the conditioning information
            </tspan>
            <tspan x="0" dy="1.5em">
              and produces parameters that describe how the target network
            </tspan>
            <tspan x="0" dy="1.5em">
              should alter its computation.
            </tspan>
          </text>
          <path d="M460,10l0,510" style="stroke-width: 1px; stroke: #666; opacity: 0.15;"/>
          <text x="500" y="20" class="figure-text">
            <tspan>
              Here, the <tspan style="font-weight: bold;">FiLM-ed network</tspan>'s
              computation
            </tspan>
            <tspan x="500" dy="1.5em">
              is conditioned by two FiLM layers.
            </tspan>
          </text>
          <g transform="translate(0, 40)">
            <g transform="translate(480, 40)">
              <text x="150" y="425" class="figure-text">input</text>
              <path d="M130,404L130,430" class="figure-line"/>
              <use x="130" y="404" xlink:href="#arrow-up" class="figure-path"/>
              <g transform="translate(20, 337)" class="figure-faded">
                <rect width="222" height="62" class="figure-filmed-network figure-group figure-box"/>
                <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
              </g>
              <path d="M130,310.5L130,337" class="figure-line"/>
              <use x="130" y="310.5" xlink:href="#arrow-up" class="figure-path"/>
              <g transform="translate(20, 275.5)" class="film-layer">
                <rect width="222" height="30" class="figure-filmed-network figure-group figure-box"/>
                <text x="111" y="15" dy="0.4em" style="text-anchor: middle; font-weight: bold;" class="figure-text">FiLM</text>
              </g>
              <path d="M130,249L130,275.5" class="figure-line"/>
              <use x="130" y="249" xlink:href="#arrow-up" class="figure-path"/>
              <g transform="translate(20, 182)" class="figure-faded">
                <rect width="222" height="62" class="figure-filmed-network figure-group figure-box"/>
                <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
              </g>
              <path d="M130,154.5L130,182" class="figure-line"/>
              <use x="130" y="154.5" xlink:href="#arrow-up" class="figure-path"/>
              <g transform="translate(20, 119.5)" class="film-layer">
                <rect width="222" height="30" class="figure-filmed-network figure-group figure-box"/>
                <text x="111" y="15" dy="0.4em" style="text-anchor: middle; font-weight: bold;" class="figure-text">FiLM</text>
              </g>
              <path d="M130,93L130,119.5" class="figure-line"/>
              <use x="130" y="93" xlink:href="#arrow-up" class="figure-path"/>
              <g transform="translate(20, 26)" class="figure-faded">
                <rect width="222" height="62" class="figure-filmed-network figure-group figure-box"/>
                <text x="111" y="31" dy="0.4em" style="text-anchor: middle;" class="figure-text">sub-network</text>
              </g>
              <text x="150" y="0" class="figure-text">output</text>
              <path d="M130,-15l0,41" class="figure-line"/>
              <use x="130" y="-15" xlink:href="#arrow-up" class="figure-path"/>
            </g>
            <g transform="translate(0, 190)">
              <path d="M0,0l130,0" class="figure-line"/>
              <use x="130" y="0" xlink:href="#arrow-right" class="figure-path"/>
              <text x="0" y="0" dy="-0.8em" class="figure-text">conditioning</text>
            </g>
            <g transform="translate(135, 140)" class="film-generator">
              <rect width="180" height="100" class="figure-film-generator figure-group figure-box"/>
              <text x="90" y="50" dy="0.4em" style="text-anchor: middle; font-weight: bold;" class="figure-text">FiLM generator</text>
            </g>
            <g>
              <path d="M315,175l175,0" class="figure-line"/>
              <use x="495" y="175" xlink:href="#arrow-right" class="figure-path"/>
              <text x="335" y="175" dy="-0.8em" class="figure-text">FiLM parameters</text>
            </g>
            <g>
              <path d="M315,205C380,205,407.5,205,407.5,265S435,330,495,330" class="figure-line"/>
              <use x="495" y="330" xlink:href="#arrow-right" class="figure-path"/>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        As the name implies, a FiLM layer applies a feature-wise affine
        transformation to its input. By <em>feature-wise</em>, we mean that
        scaling and shifting are applied element-wise, or in the case of
        convolutional networks, feature map-wise.
        <d-footnote>
          To expand a little more on the convolutional case, feature maps can be
          thought of as the same feature detector being evaluated at different
          spatial locations, in which case it makes sense to apply the same
          affine transformation to all spatial locations.
        </d-footnote>
        In other words, assuming <d-math>\mathbf{x}</d-math> is a FiLM layer's
        input and <d-math>\mathbf{z}</d-math> is the conditioning information,
        and assuming <d-math>\gamma</d-math> and <d-math>\beta</d-math> are
        <d-math>\mathbf{z}</d-math>-dependent scaling and shifting vectors,

        <d-math block>
            \textrm{FiLM}(\mathbf{x}) = \gamma(\mathbf{z}) \odot \mathbf{x}
                                                           + \beta(\mathbf{z}).
        </d-math>

        You can interact with the following fully-connected and convolutional
        FiLM layers to get an intuition of the sort of modulation they allow:
      </p>
      <figure class="l-page-outset" id="film-diagram">
        <svg viewBox="0 0 900 650" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)" id="mlp-figure">
            <text x="240" y="10" class="figure-text">
              <tspan>
                In a <tspan style="font-weight: bold;">fully-connected</tspan>
                FiLM layer,
              </tspan>
              <tspan x="240" dy="1.5em">
                a different affine transformation is
              </tspan>
              <tspan x="240" dy="1.5em">
                applied to each feature.
              </tspan>
            </text>
            <text x="0" y="175" class="figure-text">
              <tspan>
                First, each feature (or channel)
              </tspan>
              <tspan x="0" dy="1.5em">
                is scaled by the corresponding
              </tspan>
              <tspan x="0" dy="1.5em">
                <tspan style="font-family: serif; font-weight: bold;">γ</tspan>
                parameter.
              </tspan>
            </text>
            <text x="0" y="365" class="figure-text">
              <tspan>
                Next, each feature (or channel)
              </tspan>
              <tspan x="0" dy="1.5em">
                is shifted by the corresponding
              </tspan>
              <tspan x="0" dy="1.5em">
                <tspan style="font-family: serif; font-weight: bold;">β</tspan>
                parameter.
              </tspan>
            </text>
            <use xlink:href="#pointer-icon" transform="translate(130, 220)"/>
            <use xlink:href="#pointer-icon" transform="translate(130, 410)"/>
            <rect x="240" y="205" width="180" height="300" class="figure-group figure-box"/>
            <g transform="translate(270, 125)" id="input-layer">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="330" y1="165" x2="330" y2="235" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(330, 235)" class="figure-path"/>
            <g transform="translate(0, 240)" id="gamma">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="180" y="260" dy="1.5em" class="figure-text" style="font-family: serif; font-size: 20px;">γ</text>
            <line x1="120" y1="260" x2="305" y2="260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(305, 260)" class="figure-path"/>
            <g transform="translate(330, 260)">
              <ellipse cx="0" cy="0" rx="20" ry="20" style="fill: #e8e8e8;" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <line x1="330" y1="280" x2="330" y2="330" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(330, 330)" class="figure-path"/>
            <g transform="translate(270, 335)" id="scaled-layer">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <line x1="330" y1="375" x2="330" y2="425" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(330, 425)" class="figure-path"/>
            <g transform="translate(0, 430)" id="beta">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
            <text x="180" y="450" dy="1.5em" class="figure-text" style="font-family: serif; font-size: 20px;">β</text>
            <line x1="120" y1="450" x2="305" y2="450" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(305, 450)" class="figure-path"/>
            <g transform="translate(330, 450)">
              <ellipse cx="0" cy="0" rx="20" ry="20" style="fill: #e8e8e8;" class="figure-element"/>
              <line x1="0" y1="7.5" x2="0" y2="-7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <line x1="330" y1="470" x2="330" y2="545" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(330, 545)" class="figure-path"/>
            <g transform="translate(270, 550)" id="shifted-layer">
              <g transform="translate(0, 0)" class="feature">
                <use xlink:href="#big-row-left" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(40, 0)" class="feature">
                <use xlink:href="#big-row-middle" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
              <g transform="translate(80, 0)" class="feature">
                <use xlink:href="#big-row-right" class="figure-element"/>
                <use xlink:href="#vector-patch-negative" transform="translate(5, 5)" opacity="1" class="vector-patch"/>
                <use xlink:href="#vector-arrow" transform="translate(20, 20)" class="figure-line"/>
              </g>
            </g>
          </g>
          <g transform="translate(422, 10)" id="cnn-figure">
            <text x="182" y="10" class="figure-text">
              <tspan>
                In a <tspan style="font-weight: bold;">convolutional</tspan>
                FiLM layer, a
              </tspan>
              <tspan x="182" dy="1.5em">
                consistent affine transformation is
              </tspan>
              <tspan x="182" dy="1.5em">
                applied to each channel.
              </tspan>
            </text>
            <rect x="182" y="205" width="180" height="300" class="figure-group figure-box"/>
            <g transform="translate(249.5, 120)" id="input-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <line x1="272" y1="170" x2="272" y2="235" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(272, 235)" class="figure-path"/>
            <text x="120" y="260" dy="1.5em" class="figure-text" style="font-family: serif; font-size: 20px;">γ</text>
            <path d="M90,240Q100,260,247,260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(247, 260)" class="figure-path"/>
            <g transform="translate(272, 260)">
              <ellipse cx="0" cy="0" rx="20" ry="20" style="fill: #e8e8e8;" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <line x1="272" y1="280" x2="272" y2="312.5" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(272, 312.5)" class="figure-path"/>
            <g transform="translate(249.5, 357.5)" id="scaled-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
            <text x="120" y="450" dy="1.5em" class="figure-text" style="font-family: serif; font-size: 20px;">β</text>
            <path d="M90,430Q100,450,247,450" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(247, 450)" class="figure-path"/>
            <line x1="272" y1="407.5" x2="272" y2="425" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(272, 425)" class="figure-path"/>
            <g transform="translate(272, 450)">
              <ellipse cx="0" cy="0" rx="20" ry="20" style="fill: #e8e8e8;" class="figure-element"/>
              <line x1="0" y1="7.5" x2="0" y2="-7.5" class="figure-line"/>
              <line x1="-7.5" y1="0" x2="7.5" y2="0" class="figure-line"/>
            </g>
            <line x1="272" y1="470" x2="272" y2="545" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(272, 545)" class="figure-path"/>
            <g transform="translate(249.5, 590)" id="shifted-layer">
              <g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -20)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
              <g transform="translate(0, -40)">
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 60, 0)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 15, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 45, 15)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, -30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 0, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
                <g transform="matrix(1, 0, -0.5, 0.5, 30, 30)" class="feature">
                  <use xlink:href="#convolutional-feature" class="figure-element"/>
                  <use xlink:href="#convolutional-patch-negative" transform="translate(5, 5)" opacity="1" class="convolutional-patch"/>
                  <use xlink:href="#convolutional-arrow" transform="translate(15, 15)" class="figure-line"/>
                </g>
              </g>
            </g>
          </g>
        </svg>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#film-diagram > svg");
            var features = [0.9, -0.5, -0.8];
            var featureMaps = [
                [[-0.6, -0.6,  0.8], [ 0.6,  0.7,  0.4], [-0.8,  0.8,  0.9]],
                [[ 0.9, -0.1,  0.5], [-0.8, -0.7,  0.5], [-0.3, -0.9, -0.2]],
                [[-0.5, -0.9,  0.6], [-0.2, -0.4,  0.2], [-0.6,  0.1, -0.3]]
            ];
            var gammas = [-1.6, 0.8, 1.8];
            var betas = [1.0, 0.5, -0.5];
            var data = [];
            for (var i = 0; i < 3; i++) {
                data.push({feature: features[i], featureMap: [], gamma: gammas[i], beta: betas[i]});
            }
            var convData = [];
            for (var k = 0; k < 3; k++) {
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < 3; j++) {
                        var d = {feature: featureMaps[i][j][k], gamma: gammas[k], beta: betas[k]};
                        convData.push(d);
                        data[2 - k].featureMap.push(d);
                    }
                }
            }
            var amplitudeScale = d3.scaleSqrt().domain([0.0, 2.0]).range([0.0, 0.8]).clamp(true);
            var mouseScale = d3.scaleLinear().domain([0.0, 40.0]).range([2.0, -2.0]).clamp(true);
            svg.select("g#mlp-figure g#input-layer").selectAll("g.feature").data(data);
            svg.select("g#mlp-figure g#gamma").selectAll("g.feature").data(data);
            svg.select("g#mlp-figure g#beta").selectAll("g.feature").data(data);
            svg.select("g#mlp-figure g#scaled-layer").selectAll("g.feature").data(data);
            svg.select("g#mlp-figure g#shifted-layer").selectAll("g.feature").data(data);
            svg.select("g#cnn-figure g#input-layer").selectAll("g.feature").data(convData);
            svg.select("g#cnn-figure g#scaled-layer").selectAll("g.feature").data(convData);
            svg.select("g#cnn-figure g#shifted-layer").selectAll("g.feature").data(convData);


            function updateSingle(selection, accessor) {
                selection.selectAll("g.feature").each(function (d, i) {
                    var r = accessor(d);
                    var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                    d3.select(this)
                      .select(".vector-patch")
                        .attr("opacity", Math.abs(s))
                        .attr("href", r < 0 ? "#vector-patch-negative" : "#vector-patch-positive");
                    d3.select(this)
                      .select(".figure-line")
                        .attr("transform", "matrix(" + [s, 0, 0, s, 20, 20] + ")");
                });
            }
            function updateSingleConv(selection, accessor) {
                selection.selectAll("g.feature").each(function (d, i) {
                    var r = accessor(d);
                    var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                    d3.select(this)
                      .select(".convolutional-patch")
                        .attr("opacity", Math.abs(s))
                        .attr("href", r < 0 ?  "#convolutional-patch-negative" : "#convolutional-patch-positive");
                    d3.select(this)
                      .select(".vector-patch")
                        .attr("opacity", Math.abs(s))
                        .attr("href", r < 0 ?  "#vector-patch-negative" : "#vector-patch-positive");
                    d3.select(this)
                      .select(".figure-line")
                        .attr("transform", "matrix(" + [s, 0, 0, s, 15, 15] + ")");
                });
            }
            function update() {
                updateSingle(svg.select("g#mlp-figure g#input-layer"), function(d) { return d.feature; });
                updateSingle(svg.select("g#mlp-figure g#gamma"), function(d) { return d.gamma; });
                updateSingle(svg.select("g#mlp-figure g#beta"), function(d) { return d.beta; });
                updateSingle(svg.select("g#mlp-figure g#scaled-layer"), function(d) { return d.gamma * d.feature; });
                updateSingle(svg.select("g#mlp-figure g#shifted-layer"), function(d) { return d.gamma * d.feature + d.beta; });
                updateSingleConv(svg.select("g#cnn-figure g#input-layer"), function(d) { return d.feature; });
                updateSingleConv(svg.select("g#cnn-figure g#scaled-layer"), function(d) { return d.gamma * d.feature; });
                updateSingleConv(svg.select("g#cnn-figure g#shifted-layer"), function(d) { return d.gamma * d.feature + d.beta; });
            }
            update();
            svg.select("g#mlp-figure g#gamma")
              .selectAll("g.feature")
                .style("cursor", "pointer")
                .on("mousemove", function (d) {
                    var newValue = mouseScale(d3.mouse(this)[1]);
                    d.gamma = newValue;
                    for (var i = 0; i < 9; i++) {
                        d.featureMap[i].gamma = newValue;
                    }
                    update();
                });
            svg.select("g#mlp-figure g#beta")
              .selectAll("g.feature")
                .style("cursor", "pointer")
                .on("mousemove", function (d, i) {
                    var newValue = mouseScale(d3.mouse(this)[1]);
                    d.beta = newValue;
                    for (var i = 0; i < 9; i++) {
                        d.featureMap[i].beta = newValue;
                    }
                    update();
                });
        })();
      </script>
      <p>
        In addition to being a good abstraction of conditional feature-wise
        transformations, the FiLM nomenclature lends itself well to the notion
        of a <em>task representation</em>. What we mean is that the
        relationship between the conditioning signal and the network it
        modulates can be understood from the point of view of multi-task
        learning, where the conditioning signal acts as a task description, and
        where the concatenation of all scaling and shifting coefficients output
        by the FiLM generator can be thought of as both an instruction on
        <em>how to modulate</em> the conditioned network and a
        <em>representation</em> of the task at hand. We will explore and
        illustrate this idea later in the article.
      </p>

      <h1>Related ideas</h1>
      <p>
        FiLM is not the first instantiation of this idea of a duality between
        neural network conditioning and multi-task learning &mdash; it is in
        fact heavily inspired by earlier work by Dumoulin et al.
        <d-cite key="dumoulin2017learned"></d-cite> on folding multiple
        feed-forward style transfer networks into a single conditional network.
        In that work, conditional feature-wise affine transformations were
        heavily coupled with a normalization operation, which is why FiLM is
        preferred as an abstraction for this article.
      </p>
      <p>
        The idea of a learning a task representation shares a strong connection
        with the zero-shot learning problem. For instance, when attempting to
        generalize to unseen object categories in an image classification
        setting it is usually assumed that each object category is represented
        by a semantic embedding vector, and the relationship between training
        and testing labels is leveraged to make predictions for unseen labels.
        Notable examples of this idea being put in practice include Frome et al.
        <d-cite key="frome2013devise"></d-cite>, Socher et al.
        <d-cite key="socher2013zero"></d-cite>, and Norouzi et al.
        <d-cite key="norouzi2014zero"></d-cite>.
      </p>
      <p>
        Some connections can also be drawn between FiLM and the following
        models and concepts:
      </p>
    <toggle-section open="false">
      <h2 id="hypernetworks">HyperNetworks</h2>
      <p>
        The notion of a secondary network predicting the parameters of a
        primary network is probably best exemplified by HyperNetworks
        <d-cite key="ha2016hypernetworks"></d-cite>. From that perspective, the
        FiLM generator can be viewed as a specialized instance of a
        HyperNetwork which predicts the FiLM parameters of the FiLM-ed network.
        The main distinction between the two resides in the number and
        specificity of predicted parameters: FiLM requires predicting far fewer
        parameters than Hypernetworks, but FiLM is also less flexible in its
        ability to modulate the model's computation. The ideal trade-off
        between flexibility and computational complexity is still an ongoing
        area of investigation &mdash; curious readers can read about many
        proposed approaches that lie on the spectrum ranging from FiLM to
        HyperNetworks in the <a href="#bibliographic-notes">Bibliographic Notes</a>.
      </p>
    </toggle-section>
    <toggle-section open="false">
      <h2 id="attention">Attention</h2>
      <p>
        Some parallels can be drawn between methods represented by the FiLM
        abstraction and attention, but the two operate in different ways which
        we think are important to disambiguate.
      </p>
      <figure class="l-page-outset" id="filmVsAttention-diagram">
        <svg viewBox="0 0 900 470" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(270,10)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                <tspan style="font-weight: bold;">Attention</tspan> computes a
              </tspan>
              <tspan x="0" dy="1.5em">
                probability distribution
              </tspan>
              <tspan x="0" dy="1.5em">
                over <tspan style="font-weight: bold;">locations</tspan>.
              </tspan>
            </text>
          </g>
          <g transform="translate(500,10)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                <tspan style="font-weight: bold;">Attention</tspan> features a
              </tspan>
              <tspan x="0" dy="1.5em">
                <tspan style="font-weight: bold;">pooling</tspan> stage.
              </tspan>
            </text>
          </g>
          <g transform="translate(760,10)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                The output of <tspan style="font-weight: bold;">attention</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                summarizes the input
              </tspan>
              <tspan x="0" dy="1.5em">
                into a vector.
              </tspan>
            </text>
          </g>
          <g transform="translate(270,280)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                <tspan style="font-weight: bold;">FiLM</tspan> computes a scaling
              </tspan>
              <tspan x="0" dy="1.5em">
                vector which is applied
              </tspan>
              <tspan x="0" dy="1.5em">
                to the <tspan style="font-weight: bold;">feature</tspan> axis.
              </tspan>
            </text>
          </g>
          <g transform="translate(760,280)">
            <text x="0" y="0" class="figure-text">
              <tspan>
                The output of <tspan style="font-weight: bold;">FiLM</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                conserves the input
              </tspan>
              <tspan x="0" dy="1.5em">
                dimensions.
              </tspan>
            </text>
          </g>
          <g id="cnn-figure-attention" transform="translate(10,130)">
            <g id="input-conv-att" transform="translate(0,0)">
              <g transform="translate(45,0)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-20)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-40)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
            </g>
            <g transform="translate(200,0)">
              <circle r="15" class="figure-element" style="fill:#e8e8e8;" cy="0" cx="0"/>
              <circle r="2" cy="0" cx="0" class="figure-path"/>
            </g>
            <text class="figure-text" style="font-size: 18px; font-family: serif;" y="-30" x="325">α</text>
            <g id="alpha-conv-att" transform="translate(245,0)">
              <g transform="translate(45,-20)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
            </g>
            <g id="out-conv-att" transform="translate(450,0)">
              <g transform="translate(45, 0)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-20)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-40)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
            </g>
            <g transform="translate(600,20)">
              <text x="60" y="-40" dy="-0.4em" class="figure-text" style="font-size:20px; font-family:serif; text-anchor: middle;">Σ</text>
              <path d="M 0 0 L 120 0" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(120,0)" class="figure-path"/>
              <path d="M 0 -20 L 120 -20" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(120,-20)" class="figure-path"/>
              <path d="M 0 -40 L 120 -40" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(120,-40)" class="figure-path"/>
            </g>
            <path d="M 380 0 430 0" class="figure-line"/>
            <use transform="translate(430 0)" class="figure-path" xlink:href="#arrow-right"/>
            <g transform="translate(810,10)" id="out-feat-att">
              <g transform="matrix(1,0,-0.5,0.5,0,0)" class="feature">
                <use xlink:href="#convolutional-feature" class="figure-element"/>
                <use xlink:href="#convolutional-patch-negative" transform="translate(5,5)" class="convolutional-patch"/>
              </g>
              <g transform="matrix(1,0,-0.5,0.5,0,-20)" class="feature">
                <use xlink:href="#convolutional-feature" class="figure-element"/>
                <use xlink:href="#convolutional-patch-negative" transform="translate(5,5)" class="convolutional-patch"/>
              </g>
              <g transform="matrix(1,0,-0.5,0.5,0,-40)" class="feature">
                <use xlink:href="#convolutional-feature" class="figure-element"/>
                <use xlink:href="#convolutional-patch-negative" transform="translate(5,5)" class="convolutional-patch"/>
              </g>
            </g>
          </g>
          <g id="cnn-figure-film" transform="translate(10,420)">
            <g id="input-conv-film" transform="translate(0,0)">
              <g transform="translate(45,0)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-20)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-40)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
            </g>
            <g transform="translate(200,0)">
              <circle r="15" class="figure-element" style="fill:#e8e8e8" cy="0" cx="0"/>
              <circle r="2" cy="0" cx="0" class="figure-path"/>
            </g>
            <g id="gamma-conv-film" transform="translate(290,10)">
              <g transform="translate(0, 0)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(0,-20)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(0,-40)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
            </g>
            <path d="M 380 0 430 0" class="figure-line"/>
            <use transform="translate(430 0)" class="figure-path" xlink:href="#arrow-right"/>
            <text class="figure-text" x="480" y="0" style="text-anchor: middle; font-size: 18px;">...</text>
            <text class="figure-text" x="480" y="0" dy="-2em" style="text-anchor: middle; opacity: 0.3;">(scaling is omitted for clarity)</text>
            <text class="figure-text" x="300" y="-45" style="font-family: serif; font-size: 18px;">γ</text>
            <path d="M 530 0 720 0" class="figure-line"/>
            <use class="figure-path" transform="translate(720,0)" xlink:href="#arrow-right"/>
            <g id="out-conv-film" transform="translate(735,0)">
              <g transform="translate(45,0)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-20)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
              <g transform="translate(45,-40)">
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,60,0)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,15,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,45,15)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,-30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,0,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
                <g class="feature" transform="matrix(1,0,-0.5,0.5,30,30)">
                  <use class="figure-element" xlink:href="#convolutional-feature"/>
                  <use class="convolutional-patch" transform="translate(5,5)" xlink:href="#convolutional-patch-negative"/>
                </g>
              </g>
            </g>
          </g>
        </svg>
      </figure>
      <script>
        (function() {
            var svg = d3.select("#filmVsAttention-diagram > svg");
            var featureMaps = [
                [[-0.6, -0.6,  0.8], [ 0.6,  0.7,  0.4], [-0.8,  0.8,  0.9]],
                [[ 0.9, -0.1,  0.5], [-0.8, -0.7,  0.5], [-0.3, -0.9, -0.2]],
                [[0.8, -0.9,  0.6], [-0.2, -0.4,  0.2], [-0.6,  0.1, -0.3]]
            ];

            var gammas = [-1.6, 0.8, 1.8];
            var betas = [1.0, 0.5, -0.5];

            // Note Alpha must be positif
            var alpha = [[0.6, 1.7, 1], [0.5, 4, 10], [0.8, 3, 7]];
            alpha_norm = 0;
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    alpha_norm = alpha_norm + alpha[i][j]
                }
            }
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    alpha[i][j] = 2* alpha[i][j] / alpha_norm
                }
            }

            var data = [];
            for (var k = 0; k < 3; k++) {
                data.push({featureMap: featureMaps[k], gamma: gammas[k], beta: betas[k], alpha: alpha});
            }

            var convData = [];
            for (var k = 0; k < 3; k++) {
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < 3; j++) {
                        var d = {feature: featureMaps[k][i][j], gamma: gammas[k], beta: betas[k], alpha: alpha[i][j]};
                        convData.push(d);
                    }
                }
            }

            var amplitudeScale = d3.scaleSqrt().domain([0.0, 2.0]).range([0.0, 0.8]).clamp(true);

            function updatePatch(selection, accessor) {
                selection.selectAll("g.feature").each(function (d, i) {
                    var r = accessor(d);
                    var s = Math.sign(r) * amplitudeScale(Math.abs(r));
                    d3.select(this)
                        .select(".convolutional-patch")
                        .attr("opacity", Math.abs(s))
                        .attr("href", r < 0 ?  "#convolutional-patch-negative" : "#convolutional-patch-positive");
                });
            }

            // Attention pipeline
            svg.select("g#cnn-figure-attention g#input-conv-att").selectAll("g.feature").data(convData);
            svg.select("g#cnn-figure-attention g#alpha-conv-att").selectAll("g.feature").data(convData);
            svg.select("g#cnn-figure-attention g#out-conv-att").selectAll("g.feature").data(convData);
            svg.select("g#cnn-figure-attention g#out-feat-att").selectAll("g.feature").data(data);

            // FiLM pipeline
            svg.select("g#cnn-figure-film g#input-conv-film").selectAll("g.feature").data(convData);
            svg.select("g#cnn-figure-film g#gamma-conv-film").selectAll("g.feature").data(data);
            svg.select("g#cnn-figure-film g#out-conv-film").selectAll("g.feature").data(convData);

            function update() {
                // Attention pipeline
                updatePatch(svg.select("g#cnn-figure-attention g#input-conv-att"), function(d) { return d.feature; });
                updatePatch(svg.select("g#cnn-figure-attention g#alpha-conv-att"), function(d) { return d.alpha; });
                updatePatch(svg.select("g#cnn-figure-attention g#out-conv-att"), function(d) { return d.alpha * d.feature; });
                updatePatch(svg.select("g#cnn-figure-attention g#out-feat-att"), function(d)   {
                    attention_pool = 0;
                    n = 0;
                    for (var i = 0; i < 3; i++) {
                        for (var j = 0; j < 3; j++) {
                            attention_pool = attention_pool + d.alpha[i][j] * d.featureMap[i][j]
                            n = n + 1
                        }
                    }
                    return attention_pool;
                });

                // FiLM pipeline
                updatePatch(svg.select("g#cnn-figure-film g#input-conv-film"), function(d) { return d.feature; });
                updatePatch(svg.select("g#cnn-figure-film g#gamma-conv-film"), function(d) { return d.gamma; });
                updatePatch(svg.select("g#cnn-figure-film g#out-conv-film"), function(d) { return d.gamma * d.feature; });
            }
            update()
        })();
      </script>
      <p>
        This difference stems from two different intuitions underlying
        attention and conditional feature-wise transformations: for the former,
        it is assumed that the useful information is contained in specific
        spatial locations or time steps, whereas for the latter, it is assumed
        that the useful information is contained in specific features or
        feature maps.
      </p>
    </toggle-section>
    <toggle-section open="false">
      <h2 id="bilinear-transformations">Bilinear transformations</h2>
      <p>
        With a little bit of stretching the operation implemented by FiLM layers
        can be seen as a special case of a bilinear transformation
        <d-cite key="tenenbaum2000separating"></d-cite> with low-rank weight
        matrices. A bilinear transformation defines the relationship between two
        inputs <d-math>\mathbf{x}</d-math> and <d-math>\mathbf{z}</d-math> and
        the <d-math>k^{th}</d-math> output feature <d-math>y_k</d-math> as

        <d-math block>
          y_k = \mathbf{x}^T W_k \mathbf{z}.
        </d-math>

        Note that for each output feature <d-math>y_k</d-math> we have a
        separate matrix <d-math>W_k</d-math>, so the full set of weights forms
        a 3-tensor.
      </p>
      <figure class="l-page-outset" id="bilinear-diagram">
        <svg viewBox="0 0 900 340" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              In a bilinear transformation, each element
            </tspan>
            <tspan x="10" dy="1.5em">
              y<tspan dy="4px" class="subscript">k</tspan>
            </tspan>
            <tspan dy="-4px">
              of the output vector <tspan style="font-weight: bold;">y</tspan> is the result of a
            </tspan>
            <tspan x="10" dy="1.5em">
              distinct vector-matrix-vector product.
            </tspan>
            <tspan x="10" dy="1.5em">
              This allows multiplicative interactions
            </tspan>
            <tspan x="10" dy="1.5em">
              between any pair of elements of
              <tspan style="font-weight: bold;">x</tspan> and
              <tspan style="font-weight: bold;">z</tspan>.
            </tspan>
          </text>
          <g transform="translate(300, 10)">
            <g transform="translate(222, 0)">
              <use xlink:href="#big-row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
              <use xlink:href="#big-row-middle" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#big-row-right" transform="translate(80, 0)" class="figure-filmed-network figure-element"/>
              <text x="-15" y="20" dy="0.4em" dy="0.4em" style="font-weight: bold;" class="figure-text">y</text>
              <path class="figure-line" d="M -179.5 74 C -179.5 54 30 95 20 45"/>
              <use xlink:href="#arrow-up" transform="translate(20, 45)" class="figure-path"/>
              <path class="figure-line" d="M 25.5 74 C 25.5 64 60 75 60 45"/>
              <use xlink:href="#arrow-up" transform="translate(60, 45)" class="figure-path"/>
              <path class="figure-line" d="M 230.5 74 C 230.5 64 90 85 100 45"/>
              <use xlink:href="#arrow-up" transform="translate(100, 45)" class="figure-path"/>
            </g>
            <g transform="translate(0, 100)">
              <g transform="translate(0, 0)">
                <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
              </g>
              <g transform="translate(65, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
              </g>
              <use xlink:href="#curly-brace-horizontal" transform="translate(0, -5)" class="figure-line"/>
              <g transform="translate(205, 0)">
                <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
              </g>
              <g transform="translate(270, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
              </g>
              <use xlink:href="#curly-brace-horizontal" transform="translate(205, -5)" class="figure-line"/>
              <g transform="translate(410, 0)">
                <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
              </g>
              <use xlink:href="#curly-brace-horizontal" transform="translate(410, -5)" class="figure-line"/>
              <g transform="translate(475, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <text x="25" y="30" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
              </g>
            </g>
            <g transform="translate(2.5, 190)">
              <g transform="translate(0, 0)">
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 40)" class="figure-film-generator figure-element"/>
                <text x="60" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan></text>
              </g>
              <g transform="translate(125, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <text x="10" y="135" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
              </g>
              <use xlink:href="#bigger-curly-brace-horizontal" transform="translate(0, -5)" class="figure-line"/>
              <g transform="translate(205, 0)">
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 40)" class="figure-film-generator figure-element"/>
                <text x="60" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan></text>
              </g>
              <g transform="translate(330, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <text x="10" y="135" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
              </g>
              <use xlink:href="#bigger-curly-brace-horizontal" transform="translate(205, -5)" class="figure-line"/>
              <g transform="translate(410, 0)">
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 40)" class="figure-film-generator figure-element"/>
                <text x="60" y="75" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan></text>
              </g>
              <g transform="translate(535, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <text x="10" y="135" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
              </g>
              <use xlink:href="#bigger-curly-brace-horizontal" transform="translate(410, -5)" class="figure-line"/>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        If we view <d-math>\mathbf{z}</d-math> as the concatenation of the
        scaling and shifting vectors <d-math>\gamma</d-math> and
        <d-math>\beta</d-math>, and if we augment the input
        <d-math>\mathbf{x}</d-math> with a 1-valued feature,
        <d-footnote>
          As is commonly done to turn a linear transformation into an affine
          transformation.
        </d-footnote>
        we can represent a feature-wise affine transformation using a bilinear
        transformation by zeroing out the appropriate entries of the weight
        matrices:
      </p>
      <figure class="l-page-outset" id="generalized-bilinear-diagram">
        <svg viewBox="0 0 900 380" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM computes elements of the output
            </tspan>
            <tspan x="10" dy="1.5em">
              vector as
              y<tspan dy="4px" class="subscript">k</tspan>
            </tspan>
            <tspan dy="-4px">
              = <tspan style="font-family: serif;">γ</tspan><tspan dy="4px" class="subscript">k</tspan>
            </tspan>
            <tspan dy="-4px">
              x<tspan dy="4px" class="subscript">k</tspan>
            </tspan>
            <tspan dy="-4px">
              + <tspan style="font-family: serif;">β</tspan><tspan dy="4px" class="subscript">k</tspan>.
            </tspan>
          </text>
          <text x="10" y="100" dy="1em" class="figure-text">
            <tspan>
              This can be expressed as a dot product
            </tspan>
            <tspan x="10" dy="1.5em">
              between a 1-augmented <tspan style="font-weight: bold;">x</tspan>
              and a sparse
            </tspan>
            <tspan x="10" dy="1.5em">
              vector containing <tspan style="font-family: serif;">γ</tspan><tspan dy="4px" class="subscript">k</tspan>
            </tspan>
            <tspan dy="-4px">
              and <tspan style="font-family: serif;">β</tspan><tspan dy="4px" class="subscript">k</tspan>
            </tspan>
            <tspan dy="-4px">
              (shaded
            </tspan>
            <tspan x="10" dy="1.5em">
              cells have a zero value).
            </tspan>
          </text>
          <text x="10" y="210" dy="1em" class="figure-text">
            <tspan>
              The sparse vector itself is obtained by
            </tspan>
            <tspan x="10" dy="1.5em">
              multiplying a low-rank weight matrix with
            </tspan>
            <tspan x="10" dy="1.5em">
              the concatenation of <tspan style="font-family: serif;">γ</tspan>
              and <tspan style="font-family: serif;">β</tspan> (once again,
            </tspan>
            <tspan x="10" dy="1.5em">
              shaded cells have a zero value).
            </tspan>
          </text>
          <g transform="translate(280, 10)">
            <g transform="translate(222, 0)">
              <use xlink:href="#big-row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
              <use xlink:href="#big-row-middle" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#big-row-right" transform="translate(80, 0)" class="figure-filmed-network figure-element"/>
              <text x="-15" y="20" dy="0.4em" dy="0.4em" style="font-weight: bold;" class="figure-text">y</text>
              <path class="figure-line" d="M -169.5 74 C -169.5 64 30 95 20 45"/>
              <use xlink:href="#arrow-up" transform="translate(20, 45)" class="figure-path"/>
              <path class="figure-line" d="M 35.5 74 C 35.5 64 60 75 60 45"/>
              <use xlink:href="#arrow-up" transform="translate(60, 45)" class="figure-path"/>
              <path class="figure-line" d="M 240.5 74 C 240.5 64 90 85 100 45"/>
              <use xlink:href="#arrow-up" transform="translate(100, 45)" class="figure-path"/>
            </g>
            <g transform="translate(0, 100)">
              <g transform="translate(0, 0)">
                <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#singleton" transform="translate(60, 0)" class="figure-filmed-network figure-element"/>
                <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
              </g>
              <g transform="translate(85, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
              </g>
              <use xlink:href="#big-curly-brace-horizontal" transform="translate(0, -5)" class="figure-line"/>
              <g transform="translate(205, 0)">
                <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#singleton" transform="translate(60, 0)" class="figure-filmed-network figure-element"/>
                <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
              </g>
              <g transform="translate(290, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
              </g>
              <use xlink:href="#big-curly-brace-horizontal" transform="translate(205, -5)" class="figure-line"/>
              <g transform="translate(410, 0)">
                <use xlink:href="#row-left" transform="translate(0, 0)"  class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-middle" transform="translate(20, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#row-right" transform="translate(40, 0)" class="figure-filmed-network figure-element"/>
                <use xlink:href="#singleton" transform="translate(60, 0)" class="figure-filmed-network figure-element"/>
                <text x="70" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle; font-weight: bold" class="figure-text">x</text>
              </g>
              <use xlink:href="#big-curly-brace-horizontal" transform="translate(410, -5)" class="figure-line"/>
              <g transform="translate(495, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <text x="25" y="40" dy="0.4em" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan><tspan dy="-4px" style="font-weight: bold;"> z</tspan></text>
              </g>
            </g>
            <g transform="translate(22.5, 210)">
              <g transform="translate(0, 0)">
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 60)" class="figure-film-generator-shaded figure-element"/>
                <text x="60" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">1</tspan></text>
                <text x="10" y="10" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
                <text x="70" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              </g>
              <g transform="translate(125, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <text x="10" y="135" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
              </g>
              <use xlink:href="#curly-brace-vertical" transform="translate(150, 0)" class="figure-line"/>
              <text x="170" y="30" dy="0.3em" style="font-family: serif;" class="figure-text">γ</text>
              <text x="170" y="90" dy="0.3em" style="font-family: serif;" class="figure-text">β</text>
              <use xlink:href="#curly-brace-vertical" transform="translate(150, 60)" class="figure-line"/>
              <use xlink:href="#bigger-curly-brace-horizontal" transform="translate(0, -5)" class="figure-line"/>
              <g transform="translate(205, 0)">
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 60)" class="figure-film-generator-shaded figure-element"/>
                <text x="60" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">2</tspan></text>
                <text x="30" y="30" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
                <text x="90" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              </g>
              <g transform="translate(330, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <text x="10" y="135" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
              </g>
              <use xlink:href="#curly-brace-vertical" transform="translate(355, 0)" class="figure-line"/>
              <text x="375" y="30" dy="0.3em" style="font-family: serif;" class="figure-text">γ</text>
              <text x="375" y="90" dy="0.3em" style="font-family: serif;" class="figure-text">β</text>
              <use xlink:href="#curly-brace-vertical" transform="translate(355, 60)" class="figure-line"/>
              <use xlink:href="#bigger-curly-brace-horizontal" transform="translate(205, -5)" class="figure-line"/>
              <g transform="translate(410, 0)">
                <use xlink:href="#matrix-top-left" transform="translate(0, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-top-right" transform="translate(100, 0)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 20)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(0, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(100, 40)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-bottom-left" transform="translate(0, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(20, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(40, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(60, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-center" transform="translate(80, 60)" class="figure-film-generator-shaded figure-element"/>
                <use xlink:href="#matrix-bottom-right" transform="translate(100, 60)" class="figure-film-generator figure-element"/>
                <text x="60" y="95" style="text-anchor: middle;" class="figure-text"><tspan>W</tspan><tspan dy="4px" class="subscript">3</tspan></text>
                <text x="50" y="50" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
                <text x="110" y="70" dy="0.4em" style="text-anchor: middle;" class="figure-text">1</text>
              </g>
              <g transform="translate(535, 0)">
                <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-middle" transform="translate(0, 80)" class="figure-film-generator figure-element"/>
                <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-film-generator figure-element"/>
                <text x="10" y="135" style="text-anchor: middle; font-weight: bold;" class="figure-text">z</text>
              </g>
              <use xlink:href="#curly-brace-vertical" transform="translate(560, 0)" class="figure-line"/>
              <text x="580" y="30" dy="0.3em" style="font-family: serif;" class="figure-text">γ</text>
              <text x="580" y="90" dy="0.3em" style="font-family: serif;" class="figure-text">β</text>
              <use xlink:href="#curly-brace-vertical" transform="translate(560, 60)" class="figure-line"/>
              <use xlink:href="#bigger-curly-brace-horizontal" transform="translate(410, -5)" class="figure-line"/>
            </g>
        </svg>
      </figure>
      <p>
        Readers interested in learning about explicit applications of bilinear
        transformations can consult the <a href="#bibliographic-notes">Bibliographic Notes</a>.
      </p>
      </toggle-section>
      <hr />

      <h1 id="film-in-literature">Feature-wise transformations in the literature</h1>
      <p>
        Feature-wise transformations find their way in many problem settings,
        but because of their very general nature and wide applicability, this
        connection is seldom drawn. Here are recent notable examples, grouped
        by application domain.
      </p>
    <toggle-section-2 open="false">
      <h2 id="generative-modeling">Generative modeling</h2>
      <p>
        Concatenation-based conditioning is used in the conditional variant of
        DCGAN <d-cite key="radford2016unsupervised"></d-cite>, a
        well-recognized class of network architectures for generative
        adversarial networks <d-cite key="goodfellow2014generative"></d-cite>.
        The class label is broadcasted as a feature map and is concatenated to
        the input of convolutional and transposed convolutional layers in the
        generator and discriminator networks.
      </p>
      <figure class="l-body-outset" id="dcgan-diagram">
        <svg viewBox="0 0 744 400" xmlns="http://www.w3.org/2000/svg">
          <path d="M475,10l0,360" style="stroke-width: 1px; stroke: #666; opacity: 0.5"/>
          <text x="10" y="10" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Concatenation-based conditioning</tspan>
              is used in the class-conditional
            </tspan>
            <tspan x="10" dy="1.5em">
              DCGAN model. Each convolutional layer is concatenated with the
            </tspan>
            <tspan x="10" dy="1.5em">
              broadcased label along the channel axis.
            </tspan>
          </text>
          <text x="495" y="10" class="figure-text">
            <tspan>
              The resulting stack of feature maps is then
            </tspan>
            <tspan x="495" dy="1.5em">
              <tspan style="font-weight: bold;">convolved</tspan>
              to produce the conditioned
            </tspan>
            <tspan x="495" dy="1.5em">
              output.
            </tspan>
          </text>
          <g transform="translate(10, 180)">
            <g transform="translate(0, 30)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
            </g>
            <g transform="translate(191, 30)">
              <rect width="40" height="120" class="figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">concatenate</text>
            </g>
            <g transform="translate(302, 30)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
              <rect x="40" y="40" width="100" height="100" style="fill-opacity: 1;" class="figure-film-generator figure-element figure-box"/>
              <text x="50" y="50" dy="0.4em" class="figure-text">class label</text>
            </g>
            <g transform="translate(493, 30)">
              <rect width="40" height="120" class="figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">convolution</text>
            </g>
            <g transform="translate(604, 30)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
            </g>
            <path d="M 120 90 L 186 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(186, 90)" class="figure-path"/>
            <path d="M 231 90 L 297 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(297, 90)" class="figure-path"/>
            <path d="M 442 90 L 488 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(488, 90)" class="figure-path"/>
            <path d="M 533 90 L 599 90" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(599, 90)" class="figure-path"/>
            <path d="M 211 -50 L 211 25" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(211, 25)" class="figure-path"/>
            <text x="211" y="10" dy="-0.4em" transform="rotate(-90, 211, 10)" class="figure-text">broadcast</text>
            <text x="211" y="-60" dy="-0.4em" style="text-anchor: middle; font-weight: bold;" class="figure-text">class label</text>
          </g>
        </svg>
      </figure>
      <p>
        Conditional biasing is used by PixelCNN <d-cite key="oord2016conditional"></d-cite>
        and WaveNet <d-cite key="oord2016wavenet"></d-cite>, two recent
        advances in autoregressive, generative modeling of image and audio data,
        respectively. In its simplest form, conditioning in PixelCNN is
        achieved by adding feature-wise, conditional biases to the output of
        all convolutional layers. In FiLM parlance, this means inserting FiLM
        layers after each convolutional layer and setting the scaling
        coefficients to a constant value of 1.
        <d-footnote>
          The authors also describe a location-dependent biasing scheme which
          cannot be expressed in terms of FiLM layers due to the absence of the
          feature-wise property.
        </d-footnote>
      </p>
      <figure class="l-body-outset" id="pixelcnn-diagram">
        <svg viewBox="0 0 744 340" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Conditional biasing</tspan> is
              used in
            </tspan>
            <tspan x="10" dy="1.5em">
              PixelCNN. Selected convolutional
            </tspan>
            <tspan x="10" dy="1.5em">
              layers are conditioned by first
            </tspan>
            <tspan x="10" dy="1.5em">
              mapping a high-level image
            </tspan>
            <tspan x="10" dy="1.5em">
              description to a bias vector.
            </tspan>
          </text>
          <text x="10" y="210" dy="1em" class="figure-text">
            <tspan>
              The bias vector is then added to
            </tspan>
            <tspan x="10" dy="1.5em">
              the input stack of feature maps.
            </tspan>
          </text>
          <g transform="translate(-20, 10)">
            <g transform="translate(284, 200)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
            </g>
            <path d="M 404 260 L 488 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(488, 260)" class="figure-path"/>
            <g transform="translate(504, 260)">
              <circle r="10" class="figure-element"/>
              <path d="M -5 0 L 5 0" class="figure-line"/>
              <path d="M 0 -5 L 0 5" class="figure-line"/>
            </g>
            <path d="M 514 260 L 599 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(599, 260)" class="figure-path"/>
            <g transform="translate(604, 200)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
            </g>
            <text x="284" y="60" dy="-0.5em" style="font-weight: bold;" class="figure-text">
              <tspan>image</tspan>
              <tspan x="284" dy="1.5em">description</tspan>
            </text>
            <g transform="translate(414, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">linear</text>
            </g>
            <g transform="translate(494, 30)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 370 60  L 409 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(409, 60)" class="figure-path"/>
            <path d="M 455 60  L 489 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(489, 60)" class="figure-path"/>
            <path d="M 504 90 L 504 245" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(504, 245)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        WaveNet describes two ways in which conditional biasing allows external
        information to modulate the behavior of the model:
      </p>
      <ol>
        <li>
          <strong>Global conditioning</strong> applies the same conditional
          bias to the whole generated sequence and is used e.g. to condition on
          speaker identity.
        </li>
        <li>
          <strong>Local conditioning</strong> applies a conditional bias which
          varies across time steps of the generated sequence and is used e.g.
          to let linguistic features in a text-to-speech model influence
          which sounds are produced.
        </li>
      </ol>
      <p>
        Like for PixelCNN, both approaches can be viewed as inserting FiLM
        layers after each convolutional layer. The main difference lies in the
        way in which the FiLM-generating network is defined: global conditioning
        expresses the FiLM-generating network as an embedding lookup which is
        broadcasted to the whole time series, whereas local conditioning
        expresses it as a mapping from an input sequence of conditioning
        information to an output sequence of FiLM parameters.
      </p>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="reinforcement-learning">Reinforcement learning</h2>
      <p>
        Feature-wise sigmoidal gating is used in the Gated-Attention architecture
        <d-cite key="chaplot2017gated"></d-cite> to fuse linguistic and visual
        information in an agent trained to follow simple natural language
        instructions in the VizDoom <d-cite key="kempa2016vizdoom"></d-cite> 3D
        environment.
      </p>
      <figure class="l-body-outset" id="gated-attention-diagram">
        <svg viewBox="0 0 744 340" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Sigmoidal gating</tspan> is
              used by Chaplot
            </tspan>
            <tspan x="10" dy="1.5em">
              et al. as a multimodal fusion
            </tspan>
            <tspan x="10" dy="1.5em">
              mechanism. A representation of the
            </tspan>
            <tspan x="10" dy="1.5em">
              instruction is mapped to a scaling
            </tspan>
            <tspan x="10" dy="1.5em">
              vector via a sigmoid layer.
            </tspan>
          </text>
          <text x="10" y="210" dy="1em" class="figure-text">
            <tspan>
              The scaling vector is then multiplied
            </tspan>
            <tspan x="10" dy="1.5em">
              with the input stack of feature maps
            </tspan>
            <tspan x="10" dy="1.5em">
              as a way to fuse information from the
            </tspan>
            <tspan x="10" dy="1.5em">
              image and instruction representations.
            </tspan>
          </text>
          <g transform="translate(-20, 10)">
            <g transform="translate(284, 200)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
            </g>
            <path d="M 404 260 L 488 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(488, 260)" class="figure-path"/>
            <g transform="translate(504, 260)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 514 260 L 599 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(599, 260)" class="figure-path"/>
            <g transform="translate(604, 200)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
            </g>
            <text x="284" y="60" dy="-0.5em" style="font-weight: bold;" class="figure-text">
              <tspan>instruction</tspan>
              <tspan x="284" dy="1.5em">representation</tspan>
            </text>
            <g transform="translate(414, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">sigmoid</text>
            </g>
            <g transform="translate(494, 30)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 380 60  L 409 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(409, 60)" class="figure-path"/>
            <path d="M 455 60  L 489 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(489, 60)" class="figure-path"/>
            <path d="M 504 90 L 504 245" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(504, 245)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        Feature-wise affine transformations are used in Kirkpatrick et al.
        <d-cite key="kirkpatrick2017overcoming"></d-cite> to help train a single agent to play 10 different Atari games. They used game-specific scaling and biases to condition a shared policy network.
      </p>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="natural-language-processing">Natural language processing</h2>
      <p>
        Feature-wise scaling is also used in the Gated-Attention Reader
        <d-cite key="dhingra2017gated"></d-cite>. The model extracts
        information from text by conditioning the document reading network on
        a query. Its architecture is formed of multiple Gated-Attention
        modules, which involve element-wise multiplications between document
        representation tokens and token-specific query representations
        extracted via soft attention on the query representation tokens.
      </p>
      <figure class="l-body-outset" id="gated-attention-reader-diagram">
        <svg viewBox="0 0 744 340" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              <tspan style="font-weight: bold;">Conditional scaling</tspan> is
              used by Dhingra
            </tspan>
            <tspan x="10" dy="1.5em">
              et al. as a way to integrate information
            </tspan>
            <tspan x="10" dy="1.5em">
              about the query to a document
            </tspan>
            <tspan x="10" dy="1.5em">
              processing network. The scaling vector
            </tspan>
            <tspan x="10" dy="1.5em">
              is the direct result of applying soft
            </tspan>
            <tspan x="10" dy="1.5em">
              attention to the
              <tspan style="font-weight: bold;">query representation</tspan>
            </tspan>
            <tspan x="10" dy="1.5em">
              <tspan style="font-weight: bold;">tokens</tspan>.
            </tspan>
          </text>
          <text x="10" y="210" dy="1em" class="figure-text">
            <tspan>
              The scaling vector is then multiplied
            </tspan>
            <tspan x="10" dy="1.5em">
              with the input <tspan style="font-weight: bold;">document</tspan>
            </tspan>
            <tspan x="10" dy="1.5em">
              <tspan style="font-weight: bold;">representation token</tspan>.
            </tspan>
          </text>
          <g transform="translate(-20, 10)">
            <text x="284" y="200" dy="-1.5em" style="font-weight: bold;" class="figure-text">
              <tspan>document</tspan>
              <tspan x="284" dy="1.5em">representation</tspan>
              <tspan x="284" dy="1.5em">token</tspan>
            </text>
            <g transform="translate(284, 230)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
            </g>
            <path d="M 304 260 L 488 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(488, 260)" class="figure-path"/>
            <path d="M 304 260 L 428 260 A 6 6 0 0 0 434 254 L 434 125" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(434, 125)" class="figure-path"/>
            <g transform="translate(504, 260)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 514 260 L 599 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(599, 260)" class="figure-path"/>
            <text x="604" y="200" style="font-weight: bold;" class="figure-text">
              <tspan>output</tspan>
              <tspan x="604" dy="1.5em">token</tspan>
            </text>
            <g transform="translate(604, 230)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="284" y="60" dy="-1.5em" style="font-weight: bold;" class="figure-text">
              <tspan>query</tspan>
              <tspan x="284" dy="1.5em">representation</tspan>
              <tspan x="284" dy="1.5em">tokens</tspan>
            </text>
            <g transform="translate(414, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">soft attention</text>
            </g>
            <g transform="translate(494, 30)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 380 60  L 409 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(409, 60)" class="figure-path"/>
            <path d="M 455 60  L 489 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(489, 60)" class="figure-path"/>
            <path d="M 504 90 L 504 245" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(504, 245)" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <p>
        Sigmoidal gating is used by Dauphin et al.
        <d-cite key="dauphin2017language"></d-cite> in their proposed gated
        linear unit, which uses half of the input features to apply feature-wise
        sigmoidal gating to the other half. This architectural feature is also
        adopted by Gehring et al. <d-cite key="gehring2017convolutional"></d-cite>,
        who introduce a fast and parallelizable model for machine translation
        in the form of a purely convolutional architecture.
      </p>
      <figure class="l-body-outset" id="convseq2seq-diagram">
        <svg viewBox="0 0 744 260" xmlns="http://www.w3.org/2000/svg">
          <text x="380" y="10" dy="1em" class="figure-text">
            <tspan>
              The <tspan style="font-style: italic;">gated linear unit</tspan>
              activation function
            </tspan>
            <tspan x="380" dy="1.5em">
              uses <tspan style="font-weight: bold;">sigmoidal gating</tspan>. Half of the input
            </tspan>
            <tspan x="380" dy="1.5em">
              features go through a sigmoid function
            </tspan>
            <tspan x="380" dy="1.5em">
              and are treated as a gating vector.
            </tspan>
          </text>
          <text x="380" y="170" dy="1em" class="figure-text">
            <tspan>
              The gating vector is then multiplied
            </tspan>
            <tspan x="380" dy="1.5em">
              with the second half of the features.
            </tspan>
          </text>
          <g transform="translate(10, 10)">
            <text x="0" y="177.5" dy="0.4em" style="text-anchor: begin;" class="figure-text">input</text>
            <g transform="translate(40, 120)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 80)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 100)" class="figure-filmed-network figure-element"/>
            </g>
            <path d="M 60 210 L 319 210" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(319, 210)" class="figure-path"/>
            <g transform="translate(334, 210)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 345 210 L 600 210" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(600, 210)" class="figure-path"/>
            <path d="M 60 150 L 130 150 a 6 6 0 0 0 6 -6 L 136 66 a 6 6 0 0 1 6 -6 L 200 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(200, 60)" class="figure-path"/>
            <g transform="translate(205, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">sigmoid</text>
            </g>
            <path d="M 245 60 L 319 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(319, 60)" class="figure-path"/>
            <g transform="translate(324, 30)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 334 90 L 334 195" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(334, 195)" class="figure-path"/>
            <g transform="translate(605, 180)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="630" y="210" dy="0.4em" style="text-anchor: begin;" class="figure-text">output</text>
          </g>
        </svg>
      </figure>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="visual-question-answering">Visual question-answering</h2>
      <p>
        Perez et al. <d-cite key="perez2017learning,perez2018film"></d-cite>
	use feature-wise affine transformations to build a
        visual reasoning model trained on the CLEVR dataset
        <d-cite key="johnson2017clevr"></d-cite> to answer questions
        about synthetic input images.
      </p>
      <figure class="l-page-outset" id="clevr-diagram">
        <svg viewBox="0 0 900 500" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)" class="film-generator">
            <text x="0" y="30" dy="1em" class="figure-text">
              <tspan>
                The <tspan style="font-weight: bold;">linguistic pipeline</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                acts as the FiLM generator.
              </tspan>
            </text>
            <text x="0" y="300" dy="1em" class="figure-text">
              <tspan>
                The <tspan style="font-weight: bold;">visual pipeline</tspan> is
              </tspan>
              <tspan x="0" dy="1.5em">
                FiLMed by adding a FiLM
              </tspan>
              <tspan x="0" dy="1.5em">
                layer to each residual block.
              </tspan>
            </text>
            <g transform="translate(140, 0)">
              <image x="48" y="300" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/clevr_input.jpg"/>
              <g class="figure-faded">
                <path d="M 144 348 L 175 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(175, 348)" class="figure-path"/>
              </g>
              <g transform="translate(180, 288)" class="figure-faded">
                <rect width="50" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="25" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 25, 60)" class="figure-text">feature extractor</text>
              </g>
              <g class="figure-faded">
                <path d="M 230 348 L 420 348" class="figure-line"/>
                <path d="M 230 348 C 260 348 242.5 278 272.5 278" class="figure-line"/>
                <path d="M 362.5 278 C 392.5 278 380 348 420 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(420, 348)" class="figure-path"/>
              </g>
              <g transform="translate(272.5, 218)">
                <g transform="translate(0, 0)" class="figure-faded">
                  <rect width="50" height="120" class="figure-filmed-network figure-element figure-box"/>
                  <text x="25" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 25, 60)" class="figure-text">sub-network</text>
                </g>
                <g class="figure-faded">
                  <path d="M 50 60 L 60 60" class="figure-line"/>
                </g>
                <g transform="translate(60, 0)">
                  <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                  <text x="15" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">FiLM layer</text>
                </g>
              </g>
              <g transform="translate(425, 288)" class="figure-faded">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">ReLU</text>
              </g>
              <path d="M 242.5 410 L 242.5 420 L 465 420 L 465 410" style="stroke-width: 1px;" class="figure-line"/>
              <text x="242.5" y="420" dy="1.5em" class="figure-text">
                <tspan>
                  Each <tspan style="font-weight: bold;">residual block</tspan>
                  has a
                </tspan>
                <tspan x="242.5" dy="1.5em">
                  FiLM layer added to it.
                </tspan>
              </text>
              <g class="figure-faded">
                <path d="M 455 348 L 645 348" class="figure-line"/>
                <path d="M 455 348 C 485 348 467.5 278 497.5 278" class="figure-line"/>
                <path d="M 587.5 278 C 617.5 278 605 348 645 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(645, 348)" class="figure-path"/>
              </g>
              <g transform="translate(497.5, 218)">
                <g transform="translate(0, 0)" class="figure-faded">
                  <rect width="50" height="120" class="figure-filmed-network figure-element figure-box"/>
                  <text x="25" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 25, 60)" class="figure-text">sub-network</text>
                </g>
                <g class="figure-faded">
                  <path d="M 50 60 L 60 60" class="figure-line"/>
                </g>
                <g transform="translate(60, 0)">
                  <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                  <text x="15" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">FiLM layer</text>
                </g>
              </g>
              <g transform="translate(650, 288)" class="figure-faded">
                <rect width="50" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="25" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 25, 60)" class="figure-text">...</text>
              </g>
              <g class="figure-faded">
                <path d="M 700 348 L 730 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(730, 348)" class="figure-path"/>
              </g>
              <g transform="translate(180, 100)">
                <rect width="520" height="40" class="figure-film-generator figure-element figure-box"/>
                <text x="260" y="20" dy="0.4em" style="font-weight: bold; text-anchor: middle;" class="figure-text">linear</text>
              </g>
              <text x="180" y="150" dy="1em" class="figure-text">FiLM parameters</text>
              <g class="figure-faded">
                <path d="M 700 60 L 724 60 a 6 6 0 0 1 6 6 L 730 114 a 6 6 0 0 1 -6 6 L 705 120" class="figure-line"/>
                <use xlink:href="#arrow-left" transform="translate(705, 120)" class="figure-path"/>
                <path d="M 675 140 L 675 283" class="figure-line"/>
                <use xlink:href="#arrow-down" transform="translate(675, 283)" class="figure-path"/>
              </g>
              <path d="M 347.5 140 L 347.5 213" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(347.5, 213)" class="figure-path"/>
              <path d="M 572.5 140 L 572.5 213" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(572.5, 213)" class="figure-path"/>
              <g transform="translate(180, 30)">
                <g transform="translate(0, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">Are</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
                <g class="figure-faded">
                  <path d="M 30 30 L 76.66 30" class="figure-line"/>
                  <use xlink:href="#arrow-right" transform="translate(76.66, 30)" class="figure-path"/>
                </g>
                <g transform="translate(81.66, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">there</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
                <g class="figure-faded">
                  <path d="M 111.66 30 L 158.34 30" class="figure-line"/>
                  <use xlink:href="#arrow-right" transform="translate(158.34, 30)" class="figure-path"/>
                </g>
                <g transform="translate(163.34, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">more</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
                <g class="figure-faded">
                  <path d="M 193.34 30 L 240 30" class="figure-line"/>
                  <use xlink:href="#arrow-right" transform="translate(240, 30)" class="figure-path"/>
                </g>
                <g transform="translate(245, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">cubes</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
                <g class="figure-faded">
                  <path d="M 275 30 L 321.66 30" class="figure-line"/>
                  <use xlink:href="#arrow-right" transform="translate(321.66, 30)" class="figure-path"/>
                </g>
                <g transform="translate(326.66, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">than</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
                <g class="figure-faded">
                  <path d="M 356.66 30 L 403.34 30" class="figure-line"/>
                  <use xlink:href="#arrow-right" transform="translate(403.34, 30)" class="figure-path"/>
                </g>
                <g transform="translate(408.34, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">yellow</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
                <g class="figure-faded">
                  <path d="M 438.34 30 L 485 30" class="figure-line"/>
                  <use xlink:href="#arrow-right" transform="translate(485, 30)" class="figure-path"/>
                </g>
                <g transform="translate(490, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">things</text>
                  <g class="figure-faded">
                    <path d="M 15 -25 L 15 -5" class="figure-line"/>
                    <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  </g>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">GRU</text>
                  </g>
                </g>
              </g>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        The model features a FiLM generator in the form of a linguistic pipeline
        extracting a question representation which is then linearly mapped to
        the FiLM parameter values. The visual pipeline is conditioned by
        inserting a FiLM layer in the residual pathway of each residual block of
        the convolutional neural network. The model is trained end-to-end on
        image-question-answer tuples.
      </p>
      <p>
        de Vries et al. <d-cite key="vries2017modulating"></d-cite> leverage
        FiLM to condition a pre-trained network. The visual pipeline of a
        visual question-answering model is modulated by the model's
        linguistic pipeline through conditional batch normalization,
        which can be viewed as a special case of FiLM. The model learns to
	answer natural language questions about real-world images
	for the GuessWhat?! <d-cite key="vries2017guesswhat"></d-cite>
	and VQAv1 <d-cite key="agrawal2015vqa"></d-cite> datasets.
      </p>
      <figure class="l-page-outset" id="guesswhat-diagram">
        <svg viewBox="0 0 900 470" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)">
            <text x="0" y="30" dy="1em" class="figure-text">
              <tspan>
                The <tspan style="font-weight: bold;">linguistic pipeline</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                acts as the FiLM generator in
              </tspan>
              <tspan x="0" dy="1.5em">
                addition to being passed as
              </tspan>
              <tspan x="0" dy="1.5em">
                input to the fusion block.
              </tspan>
            </text>
            <text x="0" y="300" dy="1em" class="figure-text">
              <tspan>
                The pre-trained <tspan style="font-weight: bold;">visual pipeline</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                is FiLMed by making the batch
              </tspan>
              <tspan x="0" dy="1.5em">
                normalization parameters
              </tspan>
              <tspan x="0" dy="1.5em">
                query-dependent.
              </tspan>
            </text>
            <g transform="translate(200, 0)">
              <image x="0" y="316" width="64" height="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/guesswhat_input.jpg"/>
              <path d="M 64 348 L 95 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(95, 348)" class="figure-path"/>
              <g transform="translate(100, 288)" class="figure-faded">
                <rect width="60" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="30" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 30, 60)" class="figure-text">sub-network</text>
              </g>
              <path d="M 160 348 L 175 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(175, 348)" class="figure-path"/>
              <g transform="translate(180, 288)" class="figure-faded">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">normalization</text>
              </g>
              <path d="M 210 348 L 225 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(225, 348)" class="figure-path"/>
              <g transform="translate(230, 288)">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">FiLM layer</text>
              </g>
              <path d="M 260 348 L 275 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(275, 348)" class="figure-path"/>
              <g transform="translate(280, 288)" class="figure-faded">
                <rect width="60" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="30" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 30, 60)" class="figure-text">sub-network</text>
              </g>
              <path d="M 340 348 L 355 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(355, 348)" class="figure-path"/>
              <g transform="translate(360, 288)" class="figure-faded">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">normalization</text>
              </g>
              <path d="M 390 348 L 405 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(405, 348)" class="figure-path"/>
              <g transform="translate(410, 288)">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">FiLM layer</text>
              </g>
              <path d="M 440 348 L 455 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(455, 348)" class="figure-path"/>
              <g transform="translate(460, 288)" class="figure-faded">
                <rect width="60" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="30" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 30, 60)" class="figure-text">...</text>
              </g>
              <path d="M 175 410 L 175 420 L 265 420 L 265 410" style="stroke-width: 1px;" class="figure-line"/>
              <text x="175" y="420" dy="1.5em" class="figure-text">
                <tspan>
                  conditional batch
                </tspan>
                <tspan x="175" dy="1.5em">
                  normalization
                </tspan>
              </text>
              <path d="M 355 410 L 355 420 L 445 420 L 445 410" style="stroke-width: 1px;" class="figure-line"/>
              <text x="355" y="420" dy="1.5em" class="figure-text">
                <tspan>
                  conditional batch
                </tspan>
                <tspan x="355" dy="1.5em">
                  normalization
                </tspan>
              </text>
              <path d="M 520 348 L 575 348" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(575, 348)" class="figure-path"/>
              <g transform="translate(100, 100)">
                <rect width="420" height="40" class="figure-film-generator figure-element figure-box"/>
                <text x="210" y="20" dy="0.4em" style="font-weight: bold; text-anchor: middle;" class="figure-text">MLP</text>
              </g>
              <text x="100" y="150" dy="1em" class="figure-text">FiLM parameters</text>
              <path d="M 520 60 L 544 60 a 6 6 0 0 1 6 6 L 550 114 a 6 6 0 0 1 -6 6 L 525 120" class="figure-line"/>
              <use xlink:href="#arrow-left" transform="translate(525, 120)" class="figure-path"/>
              <path d="M 550 110 L 550 154 a 6 6 0 0 0 6 6 L 575 160" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(575, 160)" class="figure-path"/>
              <path d="M 245 140 L 245 283" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(245, 283)" class="figure-path"/>
              <path d="M 425 140 L 425 283" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(425, 283)" class="figure-path"/>
              <path d="M 490 140 L 490 283" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(490, 283)" class="figure-path"/>
              <g transform="translate(580, 100)" style="opacity: 0.6;">
                <rect width="40" height="308" style="fill: #e0e0e0;" class="figure-element figure-box"/>
                <text x="20" y="154" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 154)" class="figure-text">fusion block</text>
              </g>
              <path d="M 620 254 L 650 254" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(650, 254)" class="figure-path"/>
              <g transform="translate(100, 30)">
                <g transform="translate(0, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">Is</text>
                  <path d="M 15 -25 L 15 -5" class="figure-line"/>
                  <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">LSTM</text>
                  </g>
                </g>
                <path d="M 30 30 L 92.5 30" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(92.5, 30)" class="figure-path"/>
                <g transform="translate(97.5, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">the</text>
                  <path d="M 15 -25 L 15 -5" class="figure-line"/>
                  <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">LSTM</text>
                  </g>
                </g>
                <path d="M 127.5 30 L 190 30" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(190, 30)" class="figure-path"/>
                <g transform="translate(195, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">umbrella</text>
                  <path d="M 15 -25 L 15 -5" class="figure-line"/>
                  <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">LSTM</text>
                  </g>
                </g>
                <path d="M 225 30 L 287.5 30" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(287.5, 30)" class="figure-path"/>
                <g transform="translate(292.5, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">upside</text>
                  <path d="M 15 -25 L 15 -5" class="figure-line"/>
                  <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">LSTM</text>
                  </g>
                </g>
                <path d="M 322.5 30 L 385 30" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(385, 30)" class="figure-path"/>
                <g transform="translate(390, 0)">
                  <text x="15" y="-30" style="text-anchor: middle;" class="figure-text">down</text>
                  <path d="M 15 -25 L 15 -5" class="figure-line"/>
                  <use xlink:href="#arrow-down" transform="translate(15, -5)" class="figure-path"/>
                  <g class="figure-faded">
                    <rect width="30" height="60" class="figure-film-generator figure-element figure-box"/>
                    <text x="15" y="30" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 30)" class="figure-text">LSTM</text>
                  </g>
                </g>
              </g>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        The visual pipeline consists of a pre-trained residual network and is
        kept fixed throughout training. The linguistic pipeline manipulates
        the visual pipeline by perturbing the residual
        network's batch normalization parameters, which re-scale and re-shift feature maps
	after activations have been normalized to have zero mean and unit variance.
	As hinted earlier, conditional batch
        normalization can be viewed as an instance of FiLM where the post-normalization
        feature-wise affine transformation is replaced with a FiLM layer.
      </p>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="style-transfer">Style transfer</h2>
      <p>
        Dumoulin et al. <d-cite key="dumoulin2017learned"></d-cite> use feature-wise
	affine transformations &mdash; in the form of conditional instance normalization layers &mdash;
	to condition a style transfer network on a chosen style image.
	Like conditional batch normalization, conditional instance normalization
        can be seen as an instance of FiLM where the
        post-normalization feature-wise affine transformation is replaced with a
        FiLM layer. These layers are introduced into a feed-forward style
        transfer network to accommodate multiple styles. Each style modeled by
        the network is associated with its own set of instance normalization
        parameters, and conditioning is achieved by applying the normalization
        with style-specific parameters.
      </p>
      <figure class="l-page-outset" id="alrfas-diagram">
        <svg viewBox="0 0 900 420" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)">
            <text x="0" y="0" dy="1em" class="figure-text">
              <tspan>
                The <tspan style="font-weight: bold;">FiLM generator</tspan> predicts
              </tspan>
              <tspan x="0" dy="1.5em">
                parameters describing the
              </tspan>
              <tspan x="0" dy="1.5em">
                target style.
              </tspan>
            </text>
            <text x="0" y="250" dy="1em" class="figure-text">
              <tspan>
                The <tspan style="font-weight: bold;">style transfer network</tspan>
              </tspan>
              <tspan x="0" dy="1.5em">
                <tspan style="font-weight: bold;">network</tspan> is conditioned by
              </tspan>
              <tspan x="0" dy="1.5em">
                making the instance
              </tspan>
              <tspan x="0" dy="1.5em">
                normalization parameters
              </tspan>
              <tspan x="0" dy="1.5em">
                style-dependent.
              </tspan>
            </text>
            <image x="200" y="0" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/cassis_cap_lombard_opus_196.jpg"/>
            <g transform="translate(340, 0)">
              <rect width="420" height="96" class="figure-film-generator figure-element figure-box"/>
              <text x="210" y="48" dy="0.4em" style="font-weight: bold; text-anchor: middle;" class="figure-text">FiLM generator</text>
            </g>
            <g class="figure-faded">
              <path d="M 296 298 L 335 298" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(335, 298)" class="figure-path"/>
              <path d="M 760 298 L 789 298" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(789, 298)" class="figure-path"/>
              <path d="M 730 96 L 730 233" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(730, 233)" class="figure-path"/>
            </g>
            <path d="M 296 48 L 335 48" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(335, 48)" class="figure-path"/>
            <path d="M 485 96 L 485 233" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(485, 233)" class="figure-path"/>
            <path d="M 665 96 L 665 233" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(665, 233)" class="figure-path"/>
            <text x="340" y="106" dy="1em" class="figure-text">FiLM parameters</text>
            <image x="200" y="250" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/tuebingen_neckarfront.jpg"/>
            <g transform="translate(240, -50)">
              <g transform="translate(100, 288)">
                <rect width="60" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="30" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 30, 60)" class="figure-text figure-text-faded">sub-network</text>
              </g>
              <g class="figure-faded">
                <path d="M 160 348 L 175 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(175, 348)" class="figure-path"/>
              </g>
              <g transform="translate(180, 288)">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="15" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text figure-text-faded">normalization</text>
              </g>
              <g class="figure-faded">
                <path d="M 210 348 L 225 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(225, 348)" class="figure-path"/>
              </g>
              <g transform="translate(230, 288)">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">FiLM layer</text>
              </g>
              <g class="figure-faded">
                <path d="M 260 348 L 275 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(275, 348)" class="figure-path"/>
              </g>
              <g transform="translate(280, 288)">
                <rect width="60" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="30" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 30, 60)" class="figure-text figure-text-faded">sub-network</text>
              </g>
              <g class="figure-faded">
                <path d="M 340 348 L 355 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(355, 348)" class="figure-path"/>
              </g>
              <g transform="translate(360, 288)">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="15" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text figure-text-faded">normalization</text>
              </g>
              <g class="figure-faded">
                <path d="M 390 348 L 405 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(405, 348)" class="figure-path"/>
              </g>
              <g transform="translate(410, 288)">
                <rect width="30" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="15" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 15, 60)" class="figure-text">FiLM layer</text>
              </g>
              <g class="figure-faded">
                <path d="M 440 348 L 455 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(455, 348)" class="figure-path"/>
              </g>
              <g transform="translate(460, 288)">
                <rect width="60" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="30" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 30, 60)" class="figure-text figure-text-faded">...</text>
              </g>
              <path d="M 175 410 L 175 420 L 265 420 L 265 410" style="stroke-width: 1px;" class="figure-line"/>
              <text x="175" y="420" dy="1.5em" class="figure-text">
                <tspan>
                  conditional instance
                </tspan>
                <tspan x="175" dy="1.5em">
                  normalization
                </tspan>
              </text>
              <path d="M 355 410 L 355 420 L 445 420 L 445 410" style="stroke-width: 1px;" class="figure-line"/>
              <text x="355" y="420" dy="1.5em" class="figure-text">
                <tspan>
                  conditional instance
                </tspan>
                <tspan x="355" dy="1.5em">
                  normalization
                </tspan>
              </text>
              <image x="554" y="300" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/tuebingen_neckarfront_cassis_cap_lombard_opus_196.jpg"/>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        Dumoulin et al. <d-cite key="dumoulin2017learned"></d-cite> use a simple embedding
	lookup to produce the instance normalization parameters, while Ghiasi et al.
	<d-cite key="ghiasi2017exploring"></d-cite> further introduce
	a <em>style prediction network</em>,
	trained jointly with the style transfer network
	to predict the conditioning parameters directly from a given style image.
      </p>
      <p>
        Yang et al. <d-cite key="yang2018efficient"></d-cite>
        use a related architecture for video object segmentation,
        the task of segmenting a particular object throughout a video given that
	object's segmentation in the first frame.
        Their model conditions an image segmentation network over a video frame on the
        provided first frame segmentation using feature-wise gains, as well
        as on the previous frame using position-wise biases.
      </p>
      <p>
        So far, many of the models we covered have two sub-networks: a primary network
        in which feature-wise transformations are applied, and a secondary
        network which outputs parameters for these transformations. However,
        this distinction between <em>FiLM-ed network</em> and <em>FiLM generator</em>
        is not strictly necessary. As an example, Huang et al. <d-cite key="huang2017arbitrary"></d-cite>
        proposes an alternative for fast and arbitrary style transfer in the
        form of an adaptive instance normalization layer, which computes
        the normalization parameters using a simple heuristic.
      </p>
      <figure class="l-page-outset" id="adain-diagram">
        <svg viewBox="0 0 900 570" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="linearStroke" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
              <stop offset="0%"   stop-color="#2196f3"/>
              <stop offset="100%" stop-color="#f44336"/>
            </linearGradient>
            <linearGradient id="linearFill" x1="0%" y1="0%" x2="0%" y2="100%" spreadMethod="pad">
              <stop offset="0%"   stop-color="#90caf9"/>
              <stop offset="100%" stop-color="#ef9a9a"/>
            </linearGradient>
          </defs>
          <g transform="translate(10, 160)">
            <text x="200" y="-150" dy="1em" class="figure-text">
              <tspan>
                The content and style
              </tspan>
              <tspan x="200" dy="1.5em">
                images are first fed
              </tspan>
              <tspan x="200" dy="1.5em">
                through the model up
              </tspan>
              <tspan x="200" dy="1.5em">
                to the adaptive instance
              </tspan>
              <tspan x="200" dy="1.5em">
                normalization layer.
              </tspan>
            </text>
            <text x="380" y="-150" dy="1em" class="figure-text">
              <tspan>
                FiLM parameters are
              </tspan>
              <tspan x="380" dy="1.5em">
                computed as the spatial
              </tspan>
              <tspan x="380" dy="1.5em">
                mean and standard
              </tspan>
              <tspan x="380" dy="1.5em">
                deviation statistics of the
              </tspan>
              <tspan x="380" dy="1.5em">
                style feature maps.
              </tspan>
            </text>
            <text x="550" y="-150" dy="1em" class="figure-text">
              <tspan>
                The FiLMed stack of
              </tspan>
              <tspan x="550" dy="1.5em">
                feature maps is fed
              </tspan>
              <tspan x="550" dy="1.5em">
                through the remainder of
              </tspan>
              <tspan x="550" dy="1.5em">
                the network to produce
              </tspan>
              <tspan x="550" dy="1.5em">
                the stylized image.
              </tspan>
            </text>
            <image x="0" y="0" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/cassis_cap_lombard_opus_196.jpg"/>
            <image x="0" y="250" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/tuebingen_neckarfront.jpg"/>
            <g class="figure-faded">
              <path d="M 96 298 L 195 298" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(195, 298)" class="figure-path"/>
            </g>
            <g transform="translate(200, -50)">
              <g class="figure-faded">
                <path d="M -104 98 L -5 98" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(-5, 98)" class="figure-path"/>
              </g>
              <g transform="translate(0, 38)">
                <rect width="90" height="120" class="figure-film-generator figure-element figure-box figure-faded"/>
                <text x="45" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 45, 60)" class="figure-text figure-text-faded">sub-network</text>
              </g>
              <line stroke-dasharray="5,5" x1="45" y1="160" x2="45" y2="288" class="figure-line"/>
              <g transform="translate(0, 288)">
                <rect width="90" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="45" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 45, 60)" class="figure-text figure-text-faded">sub-network</text>
              </g>
              <g class="figure-faded">
                <path d="M 90 98 L 175 98" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(175, 98)" class="figure-path"/>
              </g>
              <g transform="translate(180, 38)">
                <rect width="90" height="120" class="figure-film-generator figure-element figure-box"/>
                <text x="45" y="60" dy="-0.5em" style="text-anchor: middle;" transform="rotate(-90, 45, 60)" class="figure-text">
                  <tspan style="font-family: serif;">γ, β</tspan><tspan> across</tspan>
                  <tspan x="45" dy="1.5em">spatial axes</tspan>
                </text>
              </g>
              <path d="M 255 158 L 255 283" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(255, 283)" class="figure-path"/>
              <text x="250" y="200" dy="1.5em" style="text-anchor: end;" class="figure-text">FiLM</text>
              <text x="250" y="215" dy="1.5em" style="text-anchor: end;" class="figure-text">parameters</text>
              <g class="figure-faded">
                <path d="M 90 348 L 175 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(175, 348)" class="figure-path"/>
              </g>
              <g transform="translate(180, 288)">
                <rect width="35" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="17.5" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 17.5, 60)" class="figure-text figure-text-faded">normalization</text>
              </g>
              <g class="figure-faded">
                <path d="M 215 348 L 230 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(230, 348)" class="figure-path"/>
              </g>
              <g transform="translate(235, 288)">
                <rect width="35" height="120" class="figure-filmed-network figure-element figure-box"/>
                <text x="17.5" y="60" dy="0.4em" style="font-weight: bold; text-anchor: middle;" transform="rotate(-90, 17.5, 60)" class="figure-text">FiLM layer</text>
              </g>
              <g class="figure-faded">
                <path d="M 270 348 L 345 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(345, 348)" class="figure-path"/>
              </g>
              <path d="M 175 410 L 175 420 L 275 420 L 275 410" style="stroke-width: 1px;" class="figure-line"/>
              <text x="175" y="420" dy="1.5em" class="figure-text">
                <tspan>
                  adaptive instance
                </tspan>
                <tspan x="175" dy="1.5em">
                  normalization
                </tspan>
              </text>
              <g transform="translate(350, 288)">
                <rect width="90" height="120" class="figure-filmed-network figure-element figure-box figure-faded"/>
                <text x="45" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 45, 60)" class="figure-text figure-text-faded">sub-network</text>
              </g>
              <g class="figure-faded">
                <path d="M 440 348 L 525 348" class="figure-line"/>
                <use xlink:href="#arrow-right" transform="translate(525, 348)" class="figure-path"/>
              </g>
              <image x="530" y="300" width="96" height="96" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/tuebingen_neckarfront_cassis_cap_lombard_opus_196.jpg"/>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        Adaptive instance normalization can be interpreted as inserting a FiLM layer midway
        through the model architecture. However, rather than relying on a secondary network
        to predict the FiLM parameters from the style image, the main network
        itself is used to extract style features which are used to compute the
        FiLM parameters. Therefore, the model can be seen as <em>both</em> the
        FiLM-ed network the FiLM generator.
      </p>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="domain-adaptation">Domain adaptation</h2>
      <p>
        Li et al. <d-cite key="li2018adaptive"></d-cite> find a similar approach highly effective
        for domain adaptation, updating the per-channel
        batch normalization statistics (mean and variance) of a network trained on one domain
        with that network's statistics in a new, target domain.
        Updating these statistics is mathematically equivalent to modifying the feature-wise
        affine transformations in batch normalization layers, as in Conditional Batch
        Normalization.
        Notably, this approach, along with Adaptive Instance Normalization, has the particular
        advantage of not requiring any extra, trainable parameters.
      </p>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="image-recognition">Image recognition</h2>
      <p>
        As we have seen so far, feature-wise transformations can be used as a
        conditioning mechanism to incorporate external information such as
        context representation, task description, class information, or user
        information. However, there is nothing preventing us from considering a
        neural network's hidden activations <em>themselves</em> as conditioning
        information. This idea gives rise to various forms of
        <em>self-conditioned</em> models.

              <p>
<figure class="l-page-outset" id="self-conditioning">
	   <svg viewBox="0 0 900 340" xmlns="http://www.w3.org/2000/svg">
   <text x="10" y="72.640007" dy="13" class="figure-text" id="text1400" style="font-size:13px;opacity:0.6;fill:#000000">
      <tspan id="tspan1390">The FiLM generator predicts the FiLM parameters </tspan>
      <tspan x="10" dy="19.5" id="tspan1394">conditioned on the network's internal activations</tspan>
    </text>
    <text x="10" y="218.64001" dy="13" class="figure-text" id="text1406" style="font-size:13px;opacity:0.6;fill:#000000">
      <tspan id="tspan1402">An arbitrary input vector (or feature map) </tspan>
      <tspan x="10" dy="19.5" id="tspan1404">is used to modulate downstream activations.</tspan>
    </text>
    <g xmlns="http://www.w3.org/2000/svg" transform="translate(10,10)" id="g1488">
    <g transform="translate(303.44,208.64)" id="g1416">
      <rect x="0" y="0" width="100" height="100" style="fill-opacity:1;stroke-width:1.5px;stroke-miterlimit:10" class="figure-filmed-network figure-element figure-box" id="rect1408"/>
      <text x="8" y="15" dy="0.40000001em" class="figure-text" id="text1414" style="font-size:13px;opacity:0.6;fill:#000000">input</text>
    </g>
    <path d="M 478.25817,259.72088 H 425.52632" class="figure-line" id="path1418" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:connector-curvature="0" style="fill:none;stroke:#666666;stroke-width:1.62;stroke-miterlimit:10;stroke-dasharray:none"/>
    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right" transform="translate(484.39817,259.72088)" class="figure-path" id="use1420" style="fill:#666666;stroke:#666666;stroke-width:1px;stroke-miterlimit:10" x="0" y="0" width="100%" height="100%"/>
    <path d="m 596.44,260 h 80" class="figure-line" id="path1428" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:connector-curvature="0" style="fill:none;stroke:#666666;stroke-width:1.62;stroke-miterlimit:10;stroke-dasharray:none"/>
    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right" transform="translate(676.44,260)" class="figure-path" id="use1430" style="fill:#666666;stroke:#666666;stroke-width:1px;stroke-miterlimit:10" x="0" y="0" width="100%" height="100%"/>
    <g transform="translate(765.68,208.64)" id="g1440">
      <rect x="-88.560043" y="0" width="100" height="100" style="fill-opacity:1;stroke-width:1.5px;stroke-miterlimit:10" class="figure-filmed-network figure-element figure-box" id="rect1432"/>
      <text x="-80" y="15" dy="5.2000003" class="figure-text" id="text1438" style="font-size:13px;opacity:0.6;fill:#000000">output</text>
    </g>
    <path d="m 403.93022,259.6739 h 24 a 6,4.1428758 0 0 0 6,-4.14288 v -129.8101 a 6,4.1428758 0 0 1 6,-4.14288 h 10" class="figure-line" id="path1442" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:connector-curvature="0" style="fill:none;stroke:#666666;stroke-width:1.62;stroke-miterlimit:10;stroke-dasharray:none"/>
    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right" transform="translate(483.55856,121.52894)" class="figure-path" id="use1444" style="fill:#666666;stroke:#666666;stroke-width:1px;stroke-miterlimit:10" x="0" y="0" width="100%" height="100%"/>
    <g transform="translate(595)" id="g1470"/>
    <path d="M 477.41856,121.52894 H 439.68671" class="figure-line" id="path1418-6" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:connector-curvature="0" style="fill:none;stroke:#666666;stroke-width:1.62;stroke-miterlimit:10;stroke-dasharray:none"/>
    <path style="fill:none;stroke:#666666;stroke-width:1.5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 536.51315,122.09215 32.56579,-0.36584 c 0,0 13.42106,0.9146 12.82896,10.06055 0,9.33067 -0.98684,63.10707 -0.98684,63.10707" id="path2113" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:connector-curvature="0" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" sodipodi:nodetypes="cccc"/>
    <path d="M 559.00059,259.72261 H 536.31323" class="figure-line" id="path1418-1" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:connector-curvature="0" style="fill:none;stroke:#666666;stroke-width:1.62;stroke-miterlimit:10;stroke-dasharray:none"/>
    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right" transform="translate(565.14059,259.72261)" class="figure-path" id="use1420-8" style="fill:#666666;stroke:#666666;stroke-width:1px;stroke-miterlimit:10" x="0" y="0" width="100%" height="100%"/>
    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#arrow-right" transform="rotate(90,190.70519,390.21588)" class="figure-path" id="use1420-8-7" style="fill:#666666;stroke:#666666;stroke-width:1px;stroke-miterlimit:10" x="-3" y="0" width="100%" height="100%"/>
    <g transform="translate(505.58431,318.35086)" id="g1516">
      <g class="figure-faded" id="g1504" style="opacity:0.35" transform="translate(-18.792716,-120.44838)">
        <rect width="50" height="120" class="figure-filmed-network figure-element figure-box" id="rect1500" x="0" y="0" style="fill-opacity:0.8;stroke-width:1.5px;stroke-miterlimit:10"/>
        <text x="25" y="60" dy="0.40000001em" style="font-size:13px;text-anchor:middle;opacity:0.6;fill:#000000" transform="rotate(-90,25,60)" class="figure-text" id="text1502">sub-network</text>
      </g>
      <g class="figure-faded" id="g1508" style="opacity:0.35"/>
      <g transform="translate(61.447284,-120.44838)" id="g1514">
        <rect width="30" height="120" class="figure-filmed-network figure-element figure-box" id="rect1510" x="0" y="0" style="fill-opacity:0.8;stroke-width:1.5px;stroke-miterlimit:10"/>
        <text x="15" y="60" dy="0.40000001em" style="font-weight:bold;font-size:13px;text-anchor:middle;opacity:0.6;fill:#000000" transform="rotate(-90,15,60)" class="figure-text" id="text1512">FiLM layer</text>
      </g>
      <g id="g1504-0" style="opacity:1" transform="translate(-18.743374,-258.46851)">
        <rect width="50" height="120" class="figure-film-generator figure-element figure-box" id="rect1500-9" x="0" y="0" style="fill-opacity:0.8;stroke-width:1.5px;stroke-miterlimit:10"/>
        <text x="25" y="65" style="font-size:13px;text-anchor:middle;opacity:0.6;fill:#000000" transform="rotate(-90,25,60)" class="figure-text" id="text1502-3">FiLM generator</text>
      </g>
    </g>
  </g>
        </svg>
      </figure>
              </p>
      <p>
        Highway Networks <d-cite key="srivastava2015highway"></d-cite> are a prime example
	of applying this principle of self-conditioning. This network architecture
	takes inspiration from the LSTMs' <d-cite key="hochreiter1997long"></d-cite>
        heavy use of feature-wise sigmoidal gating in their input, forget, and
        output gates to regulate information flow:
      </p>
      <figure class="l-body" id="highway-network-diagram">
        <svg viewBox="0 0 648 380" xmlns="http://www.w3.org/2000/svg">
          <g transform="translate(10, 10)">
            <text x="0" y="180" dy="0.4em" class="figure-text">input</text>
            <g transform="translate(40, 140)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <path d="M 65 180 L 285 180" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(285, 180)" class="figure-path"/>
            <path d="M 65 180 C 115 180 65 50 115 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(115, 60)" class="figure-path"/>
            <path d="M 65 180 C 115 180 65 310 115 300" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(115, 300)" class="figure-path"/>
            <g transform="translate(120, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">sub-network</text>
            </g>
            <path d="M 160 60 L 215 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(215, 60)" class="figure-path"/>
            <g transform="translate(220, 20)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 245 60 L 345 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(345, 60)" class="figure-path"/>
            <g transform="translate(120, 240)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">sigmoidal layer</text>
            </g>
            <path d="M 160 300 L 215 300" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(215, 300)" class="figure-path"/>
            <g transform="translate(220, 260)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 245 300 L 294 300 a 6 6 0 0 0 6 -6 L 300 195" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(300, 195)" class="figure-path"/>
            <path d="M 245 300 L 354 300 a 6 6 0 0 0 6 -6 L 360 185" class="figure-line"/>
            <path d="M 360 175 L 360 150" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(360, 150)" class="figure-path"/>
            <g transform="translate(330, 115)">
              <rect width="60" height="30" class="figure-element figure-box"/>
              <text x="30" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text">1 - x</text>
            </g>
            <path d="M 360 115 L 360 75" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(360, 75)" class="figure-path"/>
            <g transform="translate(300, 180)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 310 180 L 405 180" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(405, 180)" class="figure-path"/>
            <g transform="translate(360, 60)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 370 60 L 414 60 a 6 6 0 0 1 6 6 L 420 165" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(420, 165)" class="figure-path"/>
            <g transform="translate(420, 180)">
              <circle r="10" class="figure-element"/>
              <path d="M -5 0 L 5 0" class="figure-line"/>
              <path d="M 0 -5 L 0 5" class="figure-line"/>
            </g>
            <path d="M 430 180 L 535 180" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(535, 180)" class="figure-path"/>
            <g transform="translate(540, 140)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 40)" class="figure-filmed-network figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 60)" class="figure-filmed-network figure-element"/>
            </g>
            <text x="570" y="180" dy="0.4em" class="figure-text">output</text>
          </g>
        </svg>
      </figure>
      <p>
        The ImageNet 2017 winning model
        <d-cite key="hu2017squeeze"></d-cite> also employs feature-wise sigmoidal gating
        in a self-conditioning manner, as a way to
        "recalibrate" a layer's activations conditioned on themselves.
      </p>
      <figure class="l-page-outset" id="squeeze-diagram">
        <svg viewBox="0 0 900 340" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              The <tspan style="font-style: italic;">squeeze-and-excitation</tspan>
              block uses
            </tspan>
            <tspan x="10" dy="1.5em">
              <tspan style="font-weight: bold;">sigmoidal gating</tspan>.
              First, the input stack
            </tspan>
            <tspan x="10" dy="1.5em">
              of feature maps is mapped to a gating
            </tspan>
            <tspan x="10" dy="1.5em">
              vector.
            </tspan>
          </text>
          <text x="10" y="210" dy="1em" class="figure-text">
            <tspan>
              The gating vector is then multiplied
            </tspan>
            <tspan x="10" dy="1.5em">
              with the input stack of feature maps.
            </tspan>
          </text>
          <g transform="translate(-20, 10)">
            <g transform="translate(284, 200)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">input</text>
            </g>
            <path d="M 404 260 L 660 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(660, 260)" class="figure-path"/>
            <g transform="translate(675, 260)">
              <circle r="10" class="figure-element"/>
              <ellipse rx="2" ry="2" class="figure-path"/>
            </g>
            <path d="M 685 260 L 765 260" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(765, 260)" class="figure-path"/>
            <g transform="translate(770, 200)">
              <rect x="0" y="0" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="10" y="10" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <rect x="20" y="20" width="100" height="100" style="fill-opacity: 1;" class="figure-filmed-network figure-element figure-box"/>
              <text x="30" y="30" dy="0.4em" class="figure-text">output</text>
            </g>
            <path d="M 404 260 L 428 260 a 6 6 0 0 0 6 -6 L 434 66 a 6 6 0 0 1 6 -6 L 450 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(450, 60)" class="figure-path"/>
            <g transform="translate(455, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">global pooling</text>
            </g>
            <path d="M 495 60 L 520 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(520, 60)" class="figure-path"/>
            <g transform="translate(525, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">ReLU layer</text>
            </g>
            <path d="M 565 60 L 590 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(590, 60)" class="figure-path"/>
            <g transform="translate(595, 0)">
              <rect width="40" height="120" class="figure-film-generator figure-element figure-box"/>
              <text x="20" y="60" dy="0.4em" style="text-anchor: middle;" transform="rotate(-90, 20, 60)" class="figure-text">sigmoidal layer</text>
            </g>
            <path d="M 635 60 L 660 60" class="figure-line"/>
            <use xlink:href="#arrow-right" transform="translate(660, 60)" class="figure-path"/>
            <g transform="translate(665, 30)">
              <use xlink:href="#column-top" transform="translate(0, 0)" class="figure-film-generator figure-element"/>
              <use xlink:href="#row-middle" transform="translate(0, 20)" class="figure-film-generator figure-element"/>
              <use xlink:href="#column-bottom" transform="translate(0, 40)" class="figure-film-generator figure-element"/>
            </g>
            <path d="M 675 90 L 675 245" class="figure-line"/>
            <use xlink:href="#arrow-down" transform="translate(675, 245)" class="figure-path"/>
          </g>
        </svg>
      </figure>
    </toggle-section-2>
    <toggle-section-2 open="false">
      <h2 id="speech-recognition">Speech recognition</h2>
      <p>
        In the speech recognition domain, the model from Kim et al. <d-cite key="kim2017dynamic"></d-cite>
        modulates a deep bidirectional LSTM using a form of conditional
        normalization which the authors call <em>dynamic layer normalization</em>.
        Similar to conditional instance normalization and conditional batch
        normalization, dynamic layer normalization can be seen as an instance of
        FiLM where the post-normalization feature-wise affine transformation is
        disabled and a FiLM layer is placed immediately after the
        normalization layer.
      </p>
      <figure class="l-page-outset" id="dln-diagram">
        <svg viewBox="0 0 900 410" xmlns="http://www.w3.org/2000/svg">
          <text x="74" y="350" dy="1em" class="figure-text">
            <tspan>
              Kim et al. achieve speaker adaptation by adapting the usual
            </tspan>
            <tspan x="74" dy="1.5em">
              LSTM architecture to condition its various gates
              on an
            </tspan>
            <tspan x="74" dy="1.5em" style="font-weight: bold;">
              utterance summarization.
            </tspan>
          </text>
          <g transform="translate(20, -60)">
            <text x="0" y="80" dy="0.4em" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">c</tspan><tspan dy="5px" class="subscript">t-1</tspan></text>
            <g class="figure-faded">
              <path d="M 20 80 L 78 80" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(78, 80)" class="figure-path"/>
              <g transform="translate(93, 80)">
                <ellipse cx="0" cy="0" rx="10" ry="10" class="figure-element"/>
                <ellipse rx="2" ry="2" class="figure-path"/>
              </g>
              <path d="M 103 80 L 268 80" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(268, 80)" class="figure-path"/>
              <g transform="translate(283, 80)">
                <ellipse rx="10" ry="10" class="figure-element"/>
                <line x1="0" y1="-5" x2="0" y2="5" class="figure-line"/>
                <line x1="-5" y1="0" x2="5" y2="0" class="figure-line"/>
              </g>
              <path d="M 293 80 L 372 80 A 6 6 0 0 1 378 86 L 378 103" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(378, 103)" class="figure-path"/>
            </g>
            <g transform="translate(378, 118)">
              <rect x="-30" y="-10" width="60" height="20" class="figure-box figure-element figure-faded"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">tanh</text>
            </g>
            <g class="figure-faded">
              <path d="M 375 80 L 430 80" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(430, 80)" class="figure-path"/>
            </g>
            <text x="435" y="80" dy="0.4em" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">c</tspan><tspan dy="5px" class="subscript">t</tspan></text>
            <g class="figure-faded">
              <path d="M 388 175 L 430 175" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(430, 175)" class="figure-path"/>
            </g>
            <text x="435" y="175" dy="0.4em" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">h</tspan><tspan dy="5px" class="subscript">t</tspan></text>
            <g class="figure-faded">
              <path d="M 283 95 L 283 165" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(283, 95)" class="figure-path"/>
              <g transform="translate(283, 175)">
                <ellipse cx="0" cy="0" rx="10" ry="10" class="figure-element"/>
                <ellipse rx="2" ry="2" class="figure-path"/>
              </g>
              <path d="M 378 128 L 378 160" class="figure-line"/>
              <use xlink:href="#arrow-down" transform="translate(378, 160)" class="figure-path"/>
              <g transform="translate(378, 175)">
                <ellipse cx="0" cy="0" rx="10" ry="10" class="figure-element"/>
                <ellipse rx="2" ry="2" class="figure-path"/>
              </g>
              <path d="M 93 215 L 93 95" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(93, 95)" class="figure-path"/>
            </g>
            <g transform="translate(93, 225)">
              <rect x="-30" y="-10" width="60" height="20" class="figure-box figure-element figure-faded"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">sigmoid</text>
            </g>
            <g class="figure-faded">
              <path d="M 188 215 L 188 181 A 6 6 0 0 1 194 175 L 268 175" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(268, 175)" class="figure-path"/>
            </g>
            <g transform="translate(188, 225)">
              <rect x="-30" y="-10" width="60" height="20" class="figure-box figure-element figure-faded"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">sigmoid</text>
            </g>
            <g class="figure-faded">
              <path d="M 283 215 L 283 190" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(283, 190)" class="figure-path"/>
            </g>
            <g transform="translate(283, 225)">
              <rect x="-30" y="-10" width="60" height="20" class="figure-box figure-element figure-faded"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">tanh</text>
            </g>
            <g class="figure-faded">
              <path d="M 378 215 L 378 190" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(378, 190)" class="figure-path"/>
            </g>
            <g transform="translate(378, 225)">
              <rect x="-30" y="-10" width="60" height="20" class="figure-box figure-element figure-faded"/>
              <text dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">sigmoid</text>
            </g>
            <g class="figure-faded">
              <path d="M 93 257 L 93 240" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(93, 240)" class="figure-path"/>
            </g>
            <g transform="translate(59, 257)">
              <rect width="70" height="40" class="figure-element figure-box"/>
              <image x="3" y="2" width="63" height="36" style="clip-path: inset(0 0 0 0 round 3px);"xlink:href="assets/dln_gate.png"/>
            </g>
            <g class="figure-faded">
              <path d="M 188 257 L 188 240" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(188, 240)" class="figure-path"/>
            </g>
            <g transform="translate(154, 257)">
              <rect width="70" height="40" class="figure-element figure-box"/>
              <image x="3" y="2" width="63" height="36" style="clip-path: inset(0 0 0 0 round 3px);"xlink:href="assets/dln_gate.png"/>
            </g>
            <g class="figure-faded">
              <path d="M 283 257 L 283 240" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(283, 240)" class="figure-path"/>
            </g>
            <g transform="translate(249, 257)">
              <rect width="70" height="40" class="figure-element figure-box"/>
              <image x="3" y="2" width="63" height="36" style="clip-path: inset(0 0 0 0 round 3px);"xlink:href="assets/dln_gate.png"/>
            </g>
            <g class="figure-faded">
              <path d="M 378 257 L 378 240" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(378, 240)" class="figure-path"/>
            </g>
            <g transform="translate(344, 257)">
              <rect width="70" height="40" class="figure-element figure-box"/>
              <image x="3" y="2" width="63" height="36" style="clip-path: inset(0 0 0 0 round 3px);"xlink:href="assets/dln_gate.png"/>
            </g>
            <text x="0" y="376" dy="0.4em" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">h</tspan><tspan dy="5px" class="subscript">t-1</tspan></text>
            <g transform="translate(0, 337)">
              <text x="0" y="0" dy="-0.25em" style="font-weight: bold;" class="figure-text">
                <tspan>
                  utterance
                </tspan>
                <tspan x="0" dy="1.25em">
                  summarization
                </tspan>
              </text>
            </g>
            <path d="M 20 376 L 60 376" class="figure-line figure-faded"/>
            <path d="M 30 357 C 30 365 30 376 50 376" class="figure-line"/>
            <g class="figure-faded">
              <path d="M 93 332 L 93 302" class="figure-line"/>
              <path d="M 93 332 C 93 302 108 332 108 302" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(93, 302)" class="figure-path"/>
              <use xlink:href="#arrow-up" transform="translate(108, 302)" class="figure-path"/>
            </g>
            <path d="M 50 376 L 87 376 A 6 6 0 0 0 93 370 L 93 332 C 93 302 78 332 78 302" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(78, 302)" class="figure-path"/>
            <g class="figure-faded">
              <path d="M 188 332 L 188 302" class="figure-line"/>
              <path d="M 188 332 C 188 302 203 332 203 302" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(188, 302)" class="figure-path"/>
              <use xlink:href="#arrow-up" transform="translate(203, 302)" class="figure-path"/>
            </g>
            <path d="M 50 376 L 182 376 A 6 6 0 0 0 188 370 L 188 332 C 188 302 173 332 173 302" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(173, 302)" class="figure-path"/>
            <g class="figure-faded">
              <path d="M 283 332 L 283 302" class="figure-line"/>
              <path d="M 283 332 C 283 302 298 332 298 302" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(283, 302)" class="figure-path"/>
              <use xlink:href="#arrow-up" transform="translate(298, 302)" class="figure-path"/>
            </g>
            <path d="M 50 376 L 277 376 A 6 6 0 0 0 283 370 L 283 332 C 283 302 268 332 268 302" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(268, 302)" class="figure-path"/>
            <g class="figure-faded">
              <path d="M 378 332 L 378 302" class="figure-line"/>
              <path d="M 378 332 C 378 302 393 332 393 302" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(378, 302)" class="figure-path"/>
              <use xlink:href="#arrow-up" transform="translate(393, 302)" class="figure-path"/>
            </g>
            <path d="M 50 376 L 372 376 A 6 6 0 0 0 378 370 L 378 332 C 378 302 363 332 363 302" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(363, 302)" class="figure-path"/>
            <path d="M 30 395 C 30 387 30 376 50 376" class="figure-line figure-faded"/>
            <text x="30" y="405" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">x</tspan><tspan dy="5px" class="subscript">t</tspan></text>
          </g>
          <text x="540" y="350" dy="1em" class="figure-text">
            <tspan>
              Each gate uses FiLM to condition on the
              <tspan style="font-weight: bold;">utterance</tspan>
            </tspan>
            <tspan x="540" dy="1.5em">
              <tspan style="font-weight: bold;">summarization</tspan>.
            </tspan>
          </text>
          <g transform="translate(600, 40)">
            <rect x="-70" y="10" width="360" height="220" class="figure-box figure-element"/>
            <path d="M -160 157 Q -130 110 -90 110" class="figure-line figure-dashed"/>
            <use xlink:href="#arrow-right" transform="translate(-80, 110)" style="fill: none;" class="figure-path"/>
            <g transform="translate(170, 30)" class="figure-faded">
              <ellipse rx="10" ry="10" class="figure-element"/>
              <line x1="0" y1="-5" x2="0" y2="5" class="figure-line"/>
              <line x1="-5" y1="0" x2="5" y2="0" class="figure-line"/>
            </g>
            <g class="figure-faded">
              <path d="M 170 20 L 170 -10" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(170, -10)" class="figure-path"/>
              <path d="M 110 60 L 110 36 A 6 6 0 0 1 116 30 L 155 30" class="figure-line"/>
              <use xlink:href="#arrow-right" transform="translate(155, 30)" class="figure-path"/>
              <path d="M 230 60 L 230 36 A 6 6 0 0 0 224 30 L 185 30" class="figure-line"/>
              <use xlink:href="#arrow-left" transform="translate(185, 30)" class="figure-path"/>
            </g>
            <g transform="translate(60, 180)">
              <rect width="100" height="30" class="figure-element figure-box figure-filmed-network figure-faded"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">linear</text>
            </g>
            <g class="figure-faded">
              <path d="M 110 180 L 110 155" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(110, 155)" class="figure-path"/>
            </g>
            <g transform="translate(60, 120)">
              <rect width="100" height="30" class="figure-element figure-box figure-filmed-network figure-faded"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">normalization</text>
            </g>
            <g class="figure-faded">
              <path d="M 110 120 L 110 95" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(110, 95)" class="figure-path"/>
            </g>
            <g transform="translate(60, 60)">
              <rect width="100" height="30" class="figure-element figure-box figure-filmed-network"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
            </g>
            <g transform="translate(180, 180)">
              <rect width="100" height="30" class="figure-element figure-box figure-filmed-network figure-faded"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">linear</text>
            </g>
            <g class="figure-faded">
              <path d="M 230 180 L 230 155" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(230, 155)" class="figure-path"/>
            </g>
            <g transform="translate(180, 120)">
              <rect width="100" height="30" class="figure-element figure-box figure-filmed-network figure-faded"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded">normalization</text>
            </g>
            <g class="figure-faded">
              <path d="M 230 120 L 230 95" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(230, 95)" class="figure-path"/>
            </g>
            <g transform="translate(180, 60)">
              <rect width="100" height="30" class="figure-element figure-box figure-filmed-network"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM</text>
            </g>
            <text x="110" y="270" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">h</tspan><tspan dy="5px" class="subscript">t-1</tspan></text>
            <g class="figure-faded">
              <path d="M 110 260 L 110 215" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(110, 215)" class="figure-path"/>
            </g>
            <text x="230" y="270" dy="0.4em" style="text-anchor: middle;" class="figure-text figure-text-faded"><tspan style="font-weight: bold;">x</tspan><tspan dy="5px" class="subscript">t</tspan></text>
            <g class="figure-faded">
              <path d="M 230 260 L 230 215" class="figure-line"/>
              <use xlink:href="#arrow-up" transform="translate(230, 215)" class="figure-path"/>
            </g>
            <g transform="translate(-60, 180)">
              <rect width="100" height="30" class="figure-element figure-box figure-film-generator"/>
              <text x="50" y="15" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM generator</text>
            </g>
            <path d="M -10 255 L -10 215" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(-10, 215)" class="figure-path"/>
            <path d="M -10 180 L -10 117 A 6 6 0 0 1 -4 111 L 84 111 A 6 6 0 0 0 90 105 L 90 95" class="figure-line"/>
            <path d="M -10 180 L -10 117 A 6 6 0 0 1 -4 111 L 204 111 A 6 6 0 0 0 210 105 L 210 95" class="figure-line"/>
            <use xlink:href="#arrow-up" transform="translate(90, 95)" class="figure-path"/>
            <use xlink:href="#arrow-up" transform="translate(210, 95)" class="figure-path"/>
            <g transform="translate(-10, 270)">
              <text x="0" y="0" dy="-0.25em" style="font-weight: bold; text-anchor: middle;" class="figure-text">
                <tspan>
                  utterance
                </tspan>
                <tspan x="0" dy="1.25em">
                  summarization
                </tspan>
              </text>
            </g>
          </g>
        </svg>
      </figure>
      <p>
        The key difference here is that the conditioning signal does not come
        from an external source, but it is instead computed from utterance
        summarization feature vectors extracted in each layer of the network
        as a way of adapting the neural acoustic model.
      </p>
    </toggle-section-2>

      <hr />

      <h1 id="film-properties">Properties of the learned task representation</h1>
      <p>
        As hinted at earlier, in adopting the FiLM perspective we implicitly
        introduce a notion of <em>task representation</em>: each task &mdash;
        be it a question about an image or a painting style to imitate &mdash;
        elicits a different set of FiLM parameters via the FiLM generator which
        can be understood as its representation in terms of how to modulate the
        FiLMed network. To help better understand the properties of this
        representation, let's focus on two FiLMed models used in fairly
        different problem settings:
      </p>
      <ul>
        <li>
          The visual reasoning model of Perez et al.
          <d-cite key="perez2017learning,perez2018film"></d-cite>, which uses
          FiLM to modulate a visual processing pipeline based off an input
          question.
        </li>
        <li>
          The artistic style transfer model of Ghiasi et al.
          <d-cite key="ghiasi2017exploring"></d-cite>, which uses FiLM to
          modulate a feed-forward style transfer network based off an input
          style image.
        </li>
      </ul>
      <p>
        As a starting point, can we discern any pattern in the FiLM parameters
        as a function of the task description? It could be that FiLM parameters
        follow a simple distribution, indicating that perhaps FiLM is used in
        consistent ways throughout the network. It could also be that there is
        more structure to the FiLM parameter distribution, perhaps because FiLM
        serves multiple purposes in the network.
      </p>
      <p>
        One way to visualize the FiLM parameter space is to plot
        <d-math>\gamma</d-math> against <d-math>\beta</d-math>, with each point
        corresponding to a specific task description and a specific feature map.
        If we color-code each point according to the feature map it belongs to
        we observe the following:
      </p>
      <figure class="l-page-outset" id="gamma-beta-diagram">
        <svg viewBox="0 0 900 560" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM parameters of the visual reasoning model for 256 questions
            </tspan>
            <tspan x="10" dy="1.5em">
              chosen at random across 16 feature maps, also chosen at random.
            </tspan>
            <tspan x="10" dy="1.5em">
              Points are color-coded by feature map.
            </tspan>
          </text>
          <text x="490" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM parameters of the style transfer model for 256 style images
            </tspan>
            <tspan x="490" dy="1.5em">
              chosen at random across 16 feature maps, also chosen at random.
            </tspan>
            <tspan x="490" dy="1.5em">
              Points are color-coded by feature map.
            </tspan>
          </text>
          <g id="clevr-plot">
            <rect x="10" y="100" width="400" height="400" style="fill: none;"/>
            <path id="x-axis" d="M 0 0 L 0 0" class="figure-path"/>
            <text id="x-axis-label" x="0" y="0" dy="0.4em" font-family="serif" class="figure-text">γ</text>
            <path d="M 0 0 L 0 0" id="y-axis" class="figure-path"/>
            <text id="y-axis-label" x="0" y="0" dy="1em" font-family="serif" class="figure-text">β</text>
          </g>
          <g transform="translate(10, 540)" id="clevr-legend"></g>
          <use xlink:href="#pointer-icon" transform="translate(340, 527)"/>
          <g id="style-transfer-plot">
            <rect x="490" y="100" width="400" height="400" style="fill: none;"/>
            <path id="x-axis" d="M 0 0 L 0 0" class="figure-path"/>
            <text id="x-axis-label" x="0" y="0" dy="0.4em" font-family="serif" class="figure-text">γ</text>
            <path d="M 0 0 L 0 0" id="y-axis" class="figure-path"/>
            <text id="y-axis-label" x="0" y="0" dy="1em" font-family="serif" class="figure-text">β</text>
          </g>
          <g transform="translate(490, 540)" id="style-transfer-legend"></g>
          <use xlink:href="#pointer-icon" transform="translate(820, 527)"/>
        </svg>
      </figure>
      <script>
        (function() {
            var setUp = function(filename, keyword) {
                // Get references to important tags
                var svg = d3.select("#gamma-beta-diagram > svg");
                var scatterPlot = svg.select(`#${keyword}-plot`);
                var boundingBox = scatterPlot.select("rect");
                var legend = svg.select(`#${keyword}-legend`);

                // Retrieve scatter plot bounding box coordinates
                var xMin = parseInt(boundingBox.attr("x"));
                var xMax = xMin + parseInt(boundingBox.attr("width"));
                var yMin = parseInt(boundingBox.attr("y"));
                var yMax = yMin + parseInt(boundingBox.attr("height"));

                var colors = [
                    "#F44336", "#E91E63", "#9C27B0", "#673AB7", "#3F51B5",
                    "#2196F3", "#03A9F4", "#00BCD4", "#009688", "#4CAF50",
                    "#8BC34A", "#CDDC39", "#FFEB3B", "#FF9800", "#795548",
                    "#9E9E9E",
                ];

                var dataset;
                var xScale;
                var yScale;

                d3.json(filename, function(data) {
                    dataset = data;

                    // Create scales mapping gamma and beta values to bounding box
                    // coordinates
                    xScale = d3.scaleLinear()
                        .domain([1.15 * d3.min(dataset, function (d) { return d.gamma; }),
                                 1.15 * d3.max(dataset, function (d) { return d.gamma; })])
                        .rangeRound([xMin, xMax]);
                    yScale = d3.scaleLinear()
                        .domain([1.15 * d3.min(dataset, function (d) { return d.beta; }),
                                 1.15 * d3.max(dataset, function (d) { return d.beta; })])
                        .rangeRound([yMax, yMin])

                    // Set up axes
                    scatterPlot.select("#x-axis")
                        .attr("d", `M ${xMin} ${yScale(0)} L ${xMax} ${yScale(0)}`);
                    scatterPlot.select("#x-axis-label")
                        .attrs({"x": xMax - 10, "y": yScale(0.0) + 10});
                    scatterPlot.select("#y-axis")
                        .attr("d", `M ${xScale(0)} ${yMax} L ${xScale(0)} ${yMin}`);
                    scatterPlot.select("#y-axis-label")
                        .attrs({"x": xScale(0.0) + 10, "y": yMin});

                    // Dispatch data points into groups by feature map
                    scatterPlot.selectAll("g")
                        .data(colors)
                      .enter().append("g")
                        .style("opacity", 1.0)
                        .each(function(c, i) {
                            d3.select(this).selectAll("circle")
                                .data(dataset.filter(function(d) { return d.feature_map == i; }))
                              .enter().append("circle")
                                .attrs({
                                    "cx": function(d) { return xScale(d.gamma); },
                                    "cy": function(d) { return yScale(d.beta); },
                                    "r": 3.0,
                                })
                                .style("fill", function(d) { return colors[i]; })
                                .style("opacity", 0.6);
                        });

                    // Create legend
                    legend.selectAll("circle")
                        .data(colors)
                      .enter().append("circle")
                        .attrs({
                            "cx": function(d, i) { return 20 * i; },
                            "cy": 0,
                            "r": 6,
                        })
                        .style("fill", function(d, i) { return colors[i]; })
                        .style("cursor", "pointer")
                        .style("opacity", 0.6);

                    // Focuses on all points by resetting the opacities
                    var focusAll = function() {
                        legend.selectAll("circle")
                            .style("opacity", 0.6);
                        scatterPlot.selectAll("g")
                            .style("opacity", 1.0);
                    };

                    // Focuses on a single feature map by lowering other feature map
                    // opacities
                    var focus = function(j) {
                        legend.selectAll("circle")
                            .style("opacity", function(d, i) { return i == j ?  0.6 : 0.1; });
                        scatterPlot.selectAll("g")
                            .style("opacity", function(d, i) { return i == j ?  1.0 : 0.1; })
                    };

                    // Add hovering behavior to legend
                    legend.selectAll("circle")
                        .on("mouseover", function (d, i) {
                            focus(i);
                        })
                        .on("mouseout", focusAll);

                    focusAll();
                });
            };
            setUp('assets/clevr_gamma_beta_subsampled.json', 'clevr');
            setUp('assets/style_gamma_beta_subsampled.json', 'style-transfer');
        })();
      </script>
      <p>
        The plots above allow us to make several interesting observations.
        First, FiLM parameters cluster by feature map in parameter
        space, and the cluster locations are not uniform across
        feature maps. The orientation of these clusters is also not
        uniform across feature maps: the main axis of variation can be
        <d-math>\gamma</d-math>-aligned, <d-math>\beta</d-math>-aligned, or
        diagonal at varying angles. These findings suggest that the affine
        transformation in FiLM layers is not modulated in a single, consistent
        way, i.e., mostly using <d-math>\gamma</d-math> only,
        <d-math>\beta</d-math> only, or <d-math>\gamma</d-math> and
        <d-math>\beta</d-math> together in some specific way. Maybe this is due
        to the affine transformation being overspecified, or maybe this shows
        that FiLM layers can be used to perform modulation operations in several
        distinct ways.
      </p>
      <p>
        Nevertheless, the fact that these parameter clusters are often somewhat
        "dense" may help explain why the style transfer model of Ghiasi et al.
        <d-cite key="ghiasi2017exploring"></d-cite> is able to perform style
        interpolations: any convex combination of FiLM parameters is likely to
        correspond to a meaningful parametrization of the FiLMed network.
      </p>
      <figure class="l-body-outset" id="style-interpolation-diagram">
        <svg viewBox="0 0 744 500" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              Two style images are passed
            </tspan>
            <tspan x="10" dy="1.5em">
              through the FiLM generator.
            </tspan>
          </text>
          <text x="300" y="10" dy="1em" class="figure-text">
            <tspan>
              The two resulting sets
            </tspan>
            <tspan x="300" dy="1.5em">
              of FiLM parameters are
            </tspan>
            <tspan x="300" dy="1.5em">
              linearly interpolated and
            </tspan>
            <tspan x="300" dy="1.5em">
              fed to the FiLM-ed network.
            </tspan>
          </text>
          <g transform="translate(0, 120)">
            <image x="10" y="10" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/style1.jpg"/>
            <path d="M 74 42 C 110 42 94 74 130 74" class="figure-line"/>
            <use x="130" y="74" xlink:href="#arrow-right" class="figure-path"/>
            <image x="10" y="94" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/style2.jpg"/>
            <path d="M 74 126 C 110 126 94 94 130 94" class="figure-line"/>
            <use x="130" y="94" xlink:href="#arrow-right" class="figure-path"/>
            <g transform="translate(135, 44)">
              <rect width="140" height="80" class="figure-film-generator figure-group figure-box"/>
              <text x="70" y="40" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM generator</text>
            </g>
            <path d="M 275 74 C 330 74 295 20 350 20" class="figure-line"/>
            <use x="350" y="20" xlink:href="#arrow-right" class="figure-path"/>
            <path d="M 275 94 C 330 94 295 160 350 160" class="figure-line"/>
            <use x="350" y="160" xlink:href="#arrow-right" class="figure-path"/>
            <use x="440" y="90" xlink:href="#arrow-right" class="figure-path"/>
          </g>
          <image x="483" y="10" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content.jpg"/>
          <path d="M 515 74 L 515 105" class="figure-line"/>
          <use x="515" y="105" xlink:href="#arrow-down" class="figure-path"/>
          <g transform="translate(445, 110)">
            <rect width="140" height="200" class="figure-filmed-network figure-group figure-box"/>
            <text x="70" y="100" dy="0.4em" style="text-anchor: middle;" class="figure-text">FiLM-ed network</text>
          </g>
          <g class="interpolation-style">
            <circle r="6" transform="translate(360, 140)" class="figure-path"/>
            <path d="M 360 140 C 420 140 380 210 440 210" class="figure-line"/>
            <image x="310" y="400" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content_stylized_0.jpg"/>
            <path d="M 515 310 C 515 380 342 330 342 395" class="figure-line"/>
            <use x="342" y="395" xlink:href="#arrow-down" class="figure-path"/>
          </g>
          <g class="interpolation-style">
            <circle r="6" transform="translate(360, 168)" class="figure-path"/>
            <path d="M 360 168 C 420 168 380 210 440 210" class="figure-line"/>
            <image x="379" y="400" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content_stylized_1.jpg"/>
            <path d="M 515 310 C 515 380 411 330 411 395" class="figure-line"/>
            <use x="411" y="395" xlink:href="#arrow-down" class="figure-path"/>
          </g>
          <g class="interpolation-style">
            <circle r="6" transform="translate(360, 196)" class="figure-path"/>
            <path d="M 360 196 C 420 196 380 210 440 210" class="figure-line"/>
            <image x="448" y="400" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content_stylized_2.jpg"/>
            <path d="M 515 310 C 515 380 480 330 480 395" class="figure-line"/>
            <use x="480" y="395" xlink:href="#arrow-down" class="figure-path"/>
          </g>
          <g class="interpolation-style">
            <circle r="6" transform="translate(360, 224)" class="figure-path"/>
            <path d="M 360 224 C 420 224 380 210 440 210" class="figure-line"/>
            <image x="517" y="400" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content_stylized_3.jpg"/>
            <path d="M 515 310 C 515 380 549 330 549 395" class="figure-line"/>
            <use x="549" y="395" xlink:href="#arrow-down" class="figure-path"/>
          </g>
          <g class="interpolation-style">
            <circle r="6" transform="translate(360, 252)" class="figure-path"/>
            <path d="M 360 252 C 420 252 380 210 440 210" class="figure-line"/>
            <image x="586" y="400" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content_stylized_4.jpg"/>
            <path d="M 515 310 C 515 380 618 330 618 395" class="figure-line"/>
            <use x="618" y="395" xlink:href="#arrow-down" class="figure-path"/>
          </g>
          <g class="interpolation-style">
            <circle r="6" transform="translate(360, 280)" class="figure-path"/>
            <path d="M 360 280 C 420 280 380 210 440 210" class="figure-line"/>
            <image x="655" y="400" width="64" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/content_stylized_5.jpg"/>
            <path d="M 515 310 C 515 380 687 330 687 395" class="figure-line"/>
            <use x="687" y="395" xlink:href="#arrow-down" class="figure-path"/>
          </g>
        </svg>
      </figure>
      <script>
        (function() {
            var colors = ["#8ed08b", "#afaed4", "#ecebf4", "#8d89c0", "#fdc692",
                          "#fda057", "#89bedc", "#f67824", "#f44f39", "#fcaf93",
                          "#fee3c8", "#d1d2e7", "#fc8161"];

            var svg = d3.select("#style-interpolation-diagram > svg");

            svg.selectAll("g.interpolation-style")
                .data([0, 1, 2, 3, 4, 5]);
            svg.selectAll("g.interpolation-style > circle")
                .data([0, 1, 2, 3, 4, 5]);

            var focus = function(i) {
                svg.selectAll("g.interpolation-style")
                    .each(function(j) {
                        d3.select(this)
                            .classed("figure-faded", i != j);
                    });
            };

            svg.selectAll("g.interpolation-style > circle")
                .on("mouseover", function (d) {
                    focus(d);
                });

            focus(0);
        })();
      </script>
      <p>
        For the visual reasoning model we can see that FiLM parameters sometimes
        form several sub-clusters for a given feature map, which is not true for
        the style transfer model.
      </p>
      <figure class="l-page-outset" id="clevr-subcluster-diagram">
        <svg viewBox="0 0 900 360" xmlns="http://www.w3.org/2000/svg">
          <text x="90" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM parameters of the visual reasoning model for feature
            </tspan>
            <tspan x="90" dy="1.5em">
              map 26 of the first FiLM layer for 256 questions chosen
            </tspan>
            <tspan x="90" dy="1.5em">
              at random.
            </tspan>
          </text>
          <text x="490" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM parameters of the visual reasoning model for feature
            </tspan>
            <tspan x="490" dy="1.5em">
              map 76 of the first FiLM layer for 256 questions chosen
            </tspan>
            <tspan x="490" dy="1.5em">
              at random.
            </tspan>
          </text>
          <g id="first-plot">
            <rect x="90" y="100" width="250" height="250" style="fill: none;"/>
            <path id="x-axis" d="M 0 0 L 0 0" class="figure-path"/>
            <text id="x-axis-label" x="0" y="0" dy="0.4em" font-family="serif" class="figure-text">γ</text>
            <path d="M 0 0 L 0 0" id="y-axis" class="figure-path"/>
            <text id="y-axis-label" x="0" y="0" dy="1em" font-family="serif" class="figure-text">β</text>
          </g>
          <g id="second-plot">
            <rect x="490" y="100" width="250" height="250" style="fill: none;"/>
            <path id="x-axis" d="M 0 0 L 0 0" class="figure-path"/>
            <text id="x-axis-label" x="0" y="0" dy="0.4em" font-family="serif" class="figure-text">γ</text>
            <path d="M 0 0 L 0 0" id="y-axis" class="figure-path"/>
            <text id="y-axis-label" x="0" y="0" dy="1em" font-family="serif" class="figure-text">β</text>
          </g>
        </svg>
      </figure>
      <script>
        (function() {
            var setUp = function(filename, keyword, color) {
                // Get references to important tags
                var svg = d3.select("#clevr-subcluster-diagram > svg");
                var scatterPlot = svg.select(`#${keyword}-plot`);
                var boundingBox = scatterPlot.select("rect");
                var legend = svg.select(`#${keyword}-legend`);

                // Retrieve scatter plot bounding box coordinates
                var xMin = parseInt(boundingBox.attr("x"));
                var xMax = xMin + parseInt(boundingBox.attr("width"));
                var yMin = parseInt(boundingBox.attr("y"));
                var yMax = yMin + parseInt(boundingBox.attr("height"));

                var colors = [
                    "#F44336", "#E91E63", "#9C27B0", "#673AB7", "#3F51B5",
                    "#2196F3", "#03A9F4", "#00BCD4", "#009688", "#4CAF50",
                    "#8BC34A", "#CDDC39", "#FFEB3B", "#FF9800", "#795548",
                    "#9E9E9E",
                ];

                var dataset;
                var xScale;
                var yScale;

                d3.json(filename, function(data) {
                    dataset = data;

                    // Create scales mapping gamma and beta values to bounding box
                    // coordinates
                    xScale = d3.scaleLinear()
                        .domain([1.15 * d3.min(dataset, function (d) { return d.gamma; }),
                                 1.15 * d3.max(dataset, function (d) { return d.gamma; })])
                        .rangeRound([xMin, xMax]);
                    yScale = d3.scaleLinear()
                        .domain([1.15 * d3.min(dataset, function (d) { return d.beta; }),
                                 1.15 * d3.max(dataset, function (d) { return d.beta; })])
                        .rangeRound([yMax, yMin])

                    // Set up axes
                    scatterPlot.select("#x-axis")
                        .attr("d", `M ${xMin} ${yScale(0)} L ${xMax} ${yScale(0)}`);
                    scatterPlot.select("#x-axis-label")
                        .attrs({"x": xMax - 10, "y": yScale(0.0) + 10});
                    scatterPlot.select("#y-axis")
                        .attr("d", `M ${xScale(0)} ${yMax} L ${xScale(0)} ${yMin}`);
                    scatterPlot.select("#y-axis-label")
                        .attrs({"x": xScale(0.0) + 10, "y": yMin});

                    // Display data points
                    scatterPlot.selectAll("circle")
                        .data(dataset)
                      .enter().append("circle")
                        .attrs({
                            "cx": function(d) { return xScale(d.gamma); },
                            "cy": function(d) { return yScale(d.beta); },
                            "r": 3.0,
                        })
                        .style("fill", colors[color])
                        .style("opacity", 0.6);
                });
            };
            setUp('assets/clevr_gamma_beta_subcluster_fm_26.json', 'first', 0);
            setUp('assets/clevr_gamma_beta_subcluster_fm_76.json', 'second', 6);
        })();
      </script>
      <p>
        At the very least, this may indicate that FiLM learns to operate in ways
        that are problem-specific, and that we should not expect to find a
        unified and problem-independent explanation for FiLM's success in
        modulating FiLMed networks. Perhaps the compositional nature of visual
        reasoning requires the model to implement several well-defined modes of
        operation which are less necessary for style transfer.
      </p>
      <p>
        The presence of sub-clusters in the case of the visual reasoning model
        also means that we should not expect question interpolations to work
        reliably, but these sub-clusters don't preclude from performing
        arithmetic on the question representations, as Perez et al.
        <d-cite key="perez2018film"></d-cite> reported.
      </p>
      <!-- <p> -->
      <!--   The notion of interpolating between tasks can be applied -->
      <!--   even in a context where its meaning is not immediately obvious. Using -->
      <!--   the model trained in Perez et al. <d-cite key="perez2018film"></d-cite>, -->
      <!--   we tried interpolating between the FiLM parameters for two CLEVR -->
      <!--   questions and found that the interpolation had an intuitive sense! -->
      <!-- </p> -->
      <!-- <figure class="l-body-outset" id="clevr-interpolation-diagram"> -->
      <!--   <svg viewBox="0 0 744 250" xmlns="http://www.w3.org/2000/svg"> -->

	  <!-- <g transform="translate(0, 30)"> -->
	  <!-- <image x="30" y="50" width="196" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/CLEVR_val_000017.png"/> -->
	  <!-- </g> -->

      <!--     <text x="280" y="10" class="figure-text"> -->
      <!--       <tspan> -->
      <!--         How many <tspan style="font-weight: bold;">purple</tspan> -->
      <!--       </tspan> -->
      <!--       <tspan x="280" dy="1.5em"> -->
      <!--         things are there? -->
      <!--       </tspan> -->
      <!--     </text> -->
      <!--     <text x="570" y="10" class="figure-text"> -->
      <!--       <tspan> -->
      <!--         How many <tspan style="font-weight: bold;">brown</tspan> -->
      <!--       </tspan> -->
      <!--       <tspan x="570" dy="1.5em"> -->
      <!--         things are there? -->
      <!--       </tspan> -->
      <!--     </text> -->

      <!--     <g transform="translate(340, 50)"> -->
      <!--       <g class="figure-faded"> -->
      <!--         <path d="M 0 0 L 270 0" class="figure-line"></path> -->
      <!--       </g> -->
      <!--       <g class="interpolated-params" class="figure-path"> -->
      <!--         <circle r="4" cx="0" class="figure-faded"/> -->
      <!--         <circle r="4" cx="30" class="figure-path"/> -->
      <!--         <circle r="4" cx="60" class="figure-path"/> -->
      <!--         <circle r="4" cx="90" class="figure-path"/> -->
      <!--         <circle r="4" cx="120" class="figure-path"/> -->
      <!--         <circle r="4" cx="150" class="figure-path"/> -->
      <!--         <circle r="4" cx="180" class="figure-path"/> -->
      <!--         <circle r="4" cx="210" class="figure-path"/> -->
      <!--         <circle r="4" cx="240" class="figure-path"/> -->
      <!--         <circle r="4" cx="270" class="figure-faded"/> -->
      <!--       </g> -->
      <!--     </g> -->

      <!--     <g transform="translate(180, 70)"> -->
      <!--       <g transform="translate(0, 150)"> -->
      <!--       <text x="80" class="figure-text">0</text> -->
      <!--       <text x="120" class="figure-text">1</text> -->
      <!--       <text x="160" class="figure-text">2</text> -->
      <!--       <text x="200" class="figure-text">3</text> -->
      <!--       <text x="240" class="figure-text">4</text> -->
      <!--       <text x="280" class="figure-text">5</text> -->
      <!--       <text x="320" class="figure-text">6</text> -->
      <!--       <text x="360" class="figure-text">7</text> -->
      <!--       <text x="400" class="figure-text">8</text> -->
      <!--       <text x="440" class="figure-text">9</text> -->
      <!--       <text x="480" class="figure-text">10</text> -->
	    <!-- <text x="300" y="25" class="figure-text" style="text-anchor: middle;"> -->
	      <!-- Predicted answer probabilities -->
	      <!-- </text> -->
      <!--       </g> -->

	    <!-- <g class="clevr-probabilities"> -->
	    <!-- <rect x="80" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="120" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="160" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="200" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="240" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="280" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="320" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="360" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="400" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="440" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- <rect x="480" width="20" height="120" class="figure-element figure-box"/> -->
	    <!-- </g> -->
      <!--     </g> -->

      <!--   </svg> -->
      <!-- </figure> -->
      <!-- <script> -->
      <!--   (function() { -->
      <!--       var svg = d3.select("#clevr-interpolation-diagram > svg"); -->
      <!--       var interpParams = svg.select(".interpolated-params"); -->
      <!--       var dataset; -->

      <!--       d3.json("assets/clevr_interpolation.json", function(data) { -->
      <!--           dataset = data; -->
      <!--           var probs = [[], [], [], [], [], [], [], [], [], [], []]; -->
      <!--           for(var i = 0; i < dataset.length; i++) { -->
      <!--               var p = dataset[i]; -->
      <!--               var sum = 0.0; -->
      <!--               for(var j = 0; j < 11; j++) { -->
      <!--                   sum += p[j]; -->
      <!--               } -->
      <!--               for(var j = 0; j < 11; j++) { -->
      <!--                   probs[j].push(p[j] / sum); -->
      <!--               } -->
      <!--           } -->

      <!--           var update = function(i) { -->
      <!--               svg.select('.clevr-probabilities') -->
		    <!-- .selectAll("rect") -->
      <!--                 .data(probs) -->
      <!--                 .transition() -->
      <!--                   .attrs({ -->
      <!--                       "y": function(d) { return 10 + (1 - d[i]) * 120; }, -->
      <!--                       "height": function(d) { return d[i] * 120; }, -->
      <!--                   }); -->

      <!--               interpParams.selectAll("circle") -->
      <!--                 .each(function(j) { -->
      <!--                   d3.select(this) -->
      <!--                     .classed("figure-faded", i != j); -->
      <!--                 }); -->

      <!--           }; -->
      <!--           update(0); -->

      <!--           interpParams.selectAll("circle") -->
      <!--             .data([0, 45, 47, 50, 55, 60, 65, 70, 90, 95]) -->
      <!--             .attr('cx', function(d, i) { return i * 30; }) -->
      <!--             .on("mouseover", function (d) { -->
      <!--                 update(d); -->
      <!--             }) -->
      <!--             .enter() -->
      <!--       }); -->
      <!--   })(); -->
      <!-- </script> -->
      <figure class="l-body" id="analogy-diagram">
        <svg viewBox="0 0 600 430" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="0" dy="1em" class="figure-text">
            <tspan>
              The model is asked a question which
            </tspan>
            <tspan x="10" dy="1.5em">
              involves an unseen combination of
            </tspan>
            <tspan x="10" dy="1.5em">
              concepts and gives the wrong answer.
            </tspan>
          </text>
          <text x="10" y="220" dy="1em" class="figure-text">
            <tspan>
              Rather than direcly relying on the FiLM
            </tspan>
            <tspan x="10" dy="1.5em">
              generator, we can combine the FiLM
            </tspan>
            <tspan x="10" dy="1.5em">
              parameters produced by three familiar
            </tspan>
            <tspan x="10" dy="1.5em">
              questions and feed the result to the
            </tspan>
            <tspan x="10" dy="1.5em">
              visual pipeline. This corrects the
            </tspan>
            <tspan x="10" dy="1.5em">
              model's answer.
            </tspan>
          </text>
          <image x="260" y="0" width="192" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/analogy_image.jpg"/>
          <text x="260" y="150" style="font-style: italic;" class="figure-text">
            Q: What is the blue big cylinder made of?
          </text>
          <text x="490" y="70" dy="-1em" style="font-style: italic;" class="figure-text">
            Q ?
          </text>
          <path d="M 457 70 L 550 70" class="figure-path"/>
          <use x="550" y="70" xlink:href="#arrow-right" class="figure-path"/>
          <text x="560" y="70" dy="0.4em" class="figure-text">Rubber</text>
          <image x="260" y="220" width="192" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/analogy_image.jpg"/>
          <text x="260" y="370" style="font-style: italic;" class="figure-text">
            <tspan>
              Q<tspan dy="4px" class="subscript">A</tspan>
            </tspan>
            <tspan dy="-4px">
              : What is the <tspan style="font-weight: bold">blue</tspan> big
              <tspan style="font-weight: bold">sphere</tspan> made of?
            </tspan>
            <tspan x="260" dy="2em">
              Q<tspan dy="4px" class="subscript">B</tspan>
            </tspan>
            <tspan dy="-4px">
              : What is the <tspan style="font-weight: bold">green</tspan> big
              <tspan style="font-weight: bold">cylinder</tspan> made of?
            </tspan>
            <tspan x="260" dy="2em">
              Q<tspan dy="4px" class="subscript">C</tspan>
            </tspan>
            <tspan dy="-4px">
              : What is the <tspan style="font-weight: bold">green</tspan> big
              <tspan style="font-weight: bold">sphere</tspan> made of?
            </tspan>
          </text>
          <text x="460" y="290" dy="-1em" style="font-style: italic;" class="figure-text">
            <tspan>Q</tspan><tspan dy="4px" class="subscript">A</tspan>
            <tspan dy="-4px">+ Q</tspan><tspan dy="4px" class="subscript">B</tspan>
            <tspan dy="-4px">- Q</tspan><tspan dy="4px" class="subscript">C</tspan>
            <tspan dy="-4px"> ?</tspan>
          </text>
          <path d="M 457 290 L 550 290" class="figure-path"/>
          <use x="550" y="290" xlink:href="#arrow-right" class="figure-path"/>
          <text x="560" y="290" dy="0.4em" class="figure-text">Metal</text>
        </svg>
      </figure>
      <p>
        Focusing on individual feature maps which exhibit sub-clusters, we can
        try to infer how questions regroup by color-coding the scatter plots
        by question type.
      </p>
      <figure class="l-page-outset" id="clevr-subcluster-color-diagram">
        <svg viewBox="0 0 900 360" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM parameters of of the visual reasoning model for feature
            </tspan>
            <tspan x="10" dy="1.5em">
              map 26 of the first FiLM layer for 256 questions chosen
            </tspan>
            <tspan x="10" dy="1.5em">
              at random.
            </tspan>
          </text>
          <text x="520" y="10" dy="1em" class="figure-text">
            <tspan>
              FiLM parameters of of the visual reasoning model for feature
            </tspan>
            <tspan x="520" dy="1.5em">
              map 76 of the first FiLM layer for 256 questions chosen
            </tspan>
            <tspan x="520" dy="1.5em">
              at random.
            </tspan>
          </text>
          <g id="first-plot">
            <rect x="10" y="100" width="250" height="250" style="fill: none;"/>
            <path id="x-axis" d="M 0 0 L 0 0" class="figure-path"/>
            <text id="x-axis-label" x="0" y="0" dy="0.4em" font-family="serif" class="figure-text">γ</text>
            <path d="M 0 0 L 0 0" id="y-axis" class="figure-path"/>
            <text id="y-axis-label" x="0" y="0" dy="1em" font-family="serif" class="figure-text">β</text>
          </g>
          <g transform="translate(300, 110)" id="first-legend"></g>
          <use xlink:href="#pointer-icon" transform="translate(285, 70)"/>
          <g id="second-plot">
            <rect x="520" y="100" width="250" height="250" style="fill: none;"/>
            <path id="x-axis" d="M 0 0 L 0 0" class="figure-path"/>
            <text id="x-axis-label" x="0" y="0" dy="0.4em" font-family="serif" class="figure-text">γ</text>
            <path d="M 0 0 L 0 0" id="y-axis" class="figure-path"/>
            <text id="y-axis-label" x="0" y="0" dy="1em" font-family="serif" class="figure-text">β</text>
          </g>
          <g transform="translate(800, 110)" id="second-legend"></g>
          <use xlink:href="#pointer-icon" transform="translate(785, 70)"/>
        </svg>
      </figure>
      <script>
        (function() {
            var setUp = function(filename, keyword, color) {
                // Get references to important tags
                var svg = d3.select("#clevr-subcluster-color-diagram > svg");
                var scatterPlot = svg.select(`#${keyword}-plot`);
                var boundingBox = scatterPlot.select("rect");
                var legend = svg.select(`#${keyword}-legend`);

                // Retrieve scatter plot bounding box coordinates
                var xMin = parseInt(boundingBox.attr("x"));
                var xMax = xMin + parseInt(boundingBox.attr("width"));
                var yMin = parseInt(boundingBox.attr("y"));
                var yMax = yMin + parseInt(boundingBox.attr("height"));

                var colors = [
                    "#F44336", "#E91E63", "#9C27B0", "#673AB7", "#3F51B5",
                    "#2196F3", "#03A9F4", "#00BCD4", "#009688", "#4CAF50",
                    "#8BC34A", "#CDDC39", "#FFEB3B",
                ];

                var question_types = [
                    "Exists", "Less than", "Greater than", "Count", "Query material",
                    "Query size", "Query color", "Query shape", "Equal color",
                    "Equal integer", "Equal shape", "Equal size", "Equal material"
                ];

                var dataset;
                var xScale;
                var yScale;

                d3.json(filename, function(data) {
                    dataset = data;

                    // Create scales mapping gamma and beta values to bounding box
                    // coordinates
                    xScale = d3.scaleLinear()
                        .domain([1.15 * d3.min(dataset, function (d) { return d.gamma; }),
                                 1.15 * d3.max(dataset, function (d) { return d.gamma; })])
                        .rangeRound([xMin, xMax]);
                    yScale = d3.scaleLinear()
                        .domain([1.15 * d3.min(dataset, function (d) { return d.beta; }),
                                 1.15 * d3.max(dataset, function (d) { return d.beta; })])
                        .rangeRound([yMax, yMin])

                    // Set up axes
                    scatterPlot.select("#x-axis")
                        .attr("d", `M ${xMin} ${yScale(0)} L ${xMax} ${yScale(0)}`);
                    scatterPlot.select("#x-axis-label")
                        .attrs({"x": xMax - 10, "y": yScale(0.0) + 10});
                    scatterPlot.select("#y-axis")
                        .attr("d", `M ${xScale(0)} ${yMax} L ${xScale(0)} ${yMin}`);
                    scatterPlot.select("#y-axis-label")
                        .attrs({"x": xScale(0.0) + 10, "y": yMin});

                    // Dispatch data points into groups by question type
                    scatterPlot.selectAll("g")
                        .data(colors)
                      .enter().append("g")
                        .style("opacity", 1.0)
                        .each(function(c, i) {
                            d3.select(this).selectAll("circle")
                                .data(dataset.filter(function(d) { return d.question_type == i; }))
                              .enter().append("circle")
                                .attrs({
                                    "cx": function(d) { return xScale(d.gamma); },
                                    "cy": function(d) { return yScale(d.beta); },
                                    "r": 3.0,
                                })
                                .style("fill", function(d) { return colors[i]; })
                                .style("opacity", 0.6);
                        });

                    // Create legend
                    legend.selectAll("circle")
                        .data(colors)
                      .enter().append("circle")
                        .attrs({
                            "cx": 0,
                            "cy": function(d, i) { return 20 * i; },
                            "r": 6,
                        })
                        .style("fill", function(d, i) { return colors[i]; })
                        .style("cursor", "pointer")
                        .style("opacity", 0.6);
                    legend.selectAll("text")
                        .data(question_types)
                      .enter().append("text")
                        .attrs({
                            "x": 20,
                            "y": function(d, i) { return 20 * i; },
                            "dy": "0.4em",
                        })
                        .classed("figure-text", true)
                        .text(function(d) { return d; });

                    // Focuses on all points by resetting the opacities
                    var focusAll = function() {
                        legend.selectAll("circle")
                            .style("opacity", 0.6);
                        scatterPlot.selectAll("g")
                            .style("opacity", 1.0);
                    };

                    // Focuses on a single question type by lowering other
                    // question type opacities
                    var focus = function(j) {
                        legend.selectAll("circle")
                            .style("opacity", function(d, i) { return i == j ?  0.6 : 0.1; });
                        scatterPlot.selectAll("g")
                            .style("opacity", function(d, i) { return i == j ?  1.0 : 0.1; })
                    };

                    // Add hovering behavior to legend
                    legend.selectAll("circle")
                        .on("mouseover", function (d, i) {
                            focus(i);
                        })
                        .on("mouseout", focusAll);

                    focusAll();
                });
            };
            setUp('assets/clevr_gamma_beta_subcluster_fm_26.json', 'first', 0);
            setUp('assets/clevr_gamma_beta_subcluster_fm_76.json', 'second', 6);
        })();
      </script>
      <p>
        Sometimes a clear pattern emerges, like for the plot on the right, where
        questions related to counting and integer equality concentrate in the
        top-right cluster. Sometimes it is harder to draw a conclusion, like for
        the plot on the left, where most question types are scattered throughout
        the three clusters.
      </p>
      <p>
        The existence of this structure has already been explored, albeit more
        indirectly, by Ghiasi et al. <d-cite key="ghiasi2017exploring"></d-cite>
        as well as Perez et al. <d-cite key="perez2018film"></d-cite>, who
        applied t-SNE <d-cite key="maaten2008visualizing"></d-cite> on the FiLM
        parameter values.
      </p>
      <figure class="l-page-outset" id="tsne-diagram">
        <svg viewBox="0 0 900 420" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="10" dy="1em" class="figure-text">
            <tspan>
              t-SNE projection of the FiLM parameters associated with
            </tspan>
            <tspan x="10" dy="1.5em">
              questions from the CLEVR validation set, color-coded by
            </tspan>
            <tspan x="10" dy="1.5em">
              question type.
            </tspan>
          </text>
          <text x="520" y="10" dy="1em" class="figure-text">
            <tspan>
              t-SNE projection of the FiLM parameters associated with
            </tspan>
            <tspan x="520" dy="1.5em">
              style images from the Painter by Numbers test set, color-
            </tspan>
            <tspan x="520" dy="1.5em">
              coded by artist name.
            </tspan>
          </text>
          <g id="clevr-plot">
            <rect x="10" y="100" width="250" height="250" style="fill: none;" id="clevr-scatter-plot"/>
          </g>
          <g transform="translate(300, 110)" id="question-types"></g>
          <use xlink:href="#pointer-icon" transform="translate(285, 70)"/>
          <g id="style-transfer-plot">
            <rect x="520" y="100" width="250" height="250" style="fill: none;" id="style-transfer-scatter-plot"/>
          </g>
          <circle cx="733" cy="220" r="20" style="stroke-width: 4px; fill: none;" class="figure-element"/>
          <g transform="translate(800, 110)" id="artist-names"></g>
          <use xlink:href="#pointer-icon" transform="translate(785, 70)"/>
          <text x="10" y="400" dy="1em" style="fill: red" class="figure-text">
            TODO: add the ability to hover over points and visualize questions
            or style images; for now we can only hover over the legend to focus
            on different labels.
          </text>
        </svg>
      </figure>
      <script>
        (function() {
            var colors = [
                "#F44336", "#E91E63", "#9C27B0", "#673AB7", "#3F51B5",
                "#2196F3", "#03A9F4", "#00BCD4", "#009688", "#4CAF50",
                "#8BC34A", "#CDDC39", "#FFEB3B", "#FF9800", "#795548",
                "#9E9E9E",
            ];
            var question_types = [
                "Exists", "Less than", "Greater than", "Count", "Query material",
                "Query size", "Query color", "Query shape", "Equal color",
                "Equal integer", "Equal shape", "Equal size", "Equal material"
            ];

            var svg = d3.select("#tsne-diagram > svg");

            var scatterPlot = svg.select("#clevr-scatter-plot");
            var xMin = parseInt(scatterPlot.attr("x"));
            var xMax = xMin + parseInt(scatterPlot.attr("width"));
            var yMin = parseInt(scatterPlot.attr("y"));
            var yMax = yMin + parseInt(scatterPlot.attr("height"));

            var dataset;
            var xScales;
            var yScales;
            d3.json("assets/clevr_res_baseline6.json", function(data) {
                svg.select("#question-types").selectAll("text")
                    .data(question_types)
                  .enter().append("text")
                    .attrs({
                        "x": 20,
                        "y": function(d, i) { return 20 * i; },
                        "dy": "0.4em",
                    })
                    .classed("figure-text", true)
                    .text(function(d) { return d; });

                svg.select("#question-types").selectAll("circle")
                    .data(question_types)
                  .enter().append("circle")
                    .attrs({
                        "cx": 0,
                        "cy": function(d, i) { return 20 * i; },
                        "r": 6,
                    })
                    .style("fill", function(d, i) { return colors[i]; })
                    .style("cursor", "pointer")
                    .style("opacity", 0.6);

                dataset = data.slice(0, 512);
                xScales = [];
                yScales = [];
                for (var i = 0; i < 1; i++) {
                    xScales.push(
                        d3.scaleLinear()
                            .domain([d3.min(dataset, function (d) { return d.layer_all.x; }),
                                     d3.max(dataset, function (d) { return d.layer_all.x; })])
                            .rangeRound([xMin, xMax])
                    );
                    yScales.push(
                        d3.scaleLinear()
                            .domain([d3.min(dataset, function (d) { return d.layer_all.y; }),
                                     d3.max(dataset, function (d) { return d.layer_all.y; })])
                            .rangeRound([yMin, yMax])
                    );
                }

                svg.select("#clevr-plot").selectAll("circle")
                    .data(dataset)
                  .enter().append("circle")
                    .attrs({
                        "cx": function(d) { return xScales[0](d.layer_all.x); },
                        "cy": function(d) { return yScales[0](d.layer_all.y); },
                        "r": 3,
                    })
                    .style("fill", function(d) { return colors[d.question_type]; })
                    .style("opacity", 0.6);

                var focusAll = function() {
                    svg.select("#question-types").selectAll("text")
                        .style("opacity", 0.6);
                    svg.select("#question-types").selectAll("circle")
                        .style("opacity", 0.6);
                    svg.select("#clevr-plot").selectAll("circle")
                        .style("opacity", 0.6)
                };

                var focus = function(j) {
                    svg.select("#question-types").selectAll("text")
                        .style("opacity", function(d, i) { return i == j ?  0.6 : 0.1; });
                    svg.select("#question-types").selectAll("circle")
                        .style("opacity", function(d, i) { return i == j ?  0.6 : 0.1; });
                    svg.select("#clevr-plot").selectAll("circle")
                        .style("opacity", function(d, i) { return d.question_type == j ?  0.6 : 0.05; })
                };

                svg.select("#question-types").selectAll("circle")
                    .on("mouseover", function (d, i) {
                        focus(i);
                    })
                    .on("mouseout", focusAll);

                focusAll();
            });
        })();
        (function() {
            var colors = [
                "#F44336", "#E91E63", "#9C27B0", "#673AB7", "#3F51B5",
                "#2196F3", "#03A9F4", "#00BCD4", "#009688", "#4CAF50",
                "#8BC34A", "#CDDC39", "#FFEB3B", "#FF9800", "#795548",
                "#9E9E9E",
            ];

            var svg = d3.select("#tsne-diagram > svg");

            var scatterPlot = svg.select("#style-transfer-scatter-plot");
            var xMin = parseInt(scatterPlot.attr("x"));
            var xMax = xMin + parseInt(scatterPlot.attr("width"));
            var yMin = parseInt(scatterPlot.attr("y"));
            var yMax = yMin + parseInt(scatterPlot.attr("height"));

            var dataset;
            var xScale;
            var yScale;
            d3.json("assets/style_tsne.json", function(data) {
                dataset = {"artists": data.artists, "points": data.points.slice(0, 512)};
                xScale = d3.scaleLinear()
                    .domain([d3.min(dataset.points, function (d) { return d.x; }),
                             d3.max(dataset.points, function (d) { return d.x; })])
                    .rangeRound([xMin, xMax]);
                yScale = d3.scaleLinear()
                    .domain([d3.min(dataset.points, function (d) { return d.y; }),
                             d3.max(dataset.points, function (d) { return d.y; })])
                    .rangeRound([yMin, yMax])

                svg.select("#style-transfer-plot").selectAll("circle")
                    .data(dataset.points)
                  .enter().append("circle")
                    .attrs({
                        "cx": function(d) { return xScale(d.x); },
                        "cy": function(d) { return yScale(d.y); },
                        "r": 3,
                    })
                    .style("fill", function(d) { return colors[d.artist_index]; })
                    .style("opacity", 0.6);

                svg.select("#artist-names").selectAll("text")
                    .data(Object.values(dataset.artists))
                  .enter().append("text")
                    .attrs({
                        "x": 20,
                        "y": function(d, i) { return 20 * i; },
                        "dy": "0.4em",
                    })
                    .classed("figure-text", true)
                    .text(function(d) { return d; });

                svg.select("#artist-names").selectAll("circle")
                    .data(Object.values(dataset.artists))
                  .enter().append("circle")
                    .attrs({
                        "cx": 0,
                        "cy": function(d, i) { return 20 * i; },
                        "r": 6,
                    })
                    .style("fill", function(d, i) { return colors[i]; })
                    .style("cursor", "pointer")
                    .style("opacity", 0.6);

                var focusAll = function() {
                    svg.select("#artist-names").selectAll("text")
                        .style("opacity", 0.6);
                    svg.select("#artist-names").selectAll("circle")
                        .style("opacity", 0.6);
                    svg.select("#style-transfer-plot").selectAll("circle")
                        .style("opacity", 0.6)
                };

                var focus = function(j) {
                    svg.select("#artist-names").selectAll("text")
                        .style("opacity", function(d, i) { return i == j ?  0.6 : 0.1; });
                    svg.select("#artist-names").selectAll("circle")
                        .style("opacity", function(d, i) { return i == j ?  0.6 : 0.1; });
                    svg.select("#style-transfer-plot").selectAll("circle")
                        .style("opacity", function(d, i) { return d.artist_index == j ?  0.6 : 0.05; })
                };

                svg.select("#artist-names").selectAll("circle")
                    .on("mouseover", function (d, i) {
                        focus(i);
                    })
                    .on("mouseout", focusAll);

                focusAll();
            });
        })();
        // Toggle Section code from: https://inclusive-components.design/collapsible-sections/
        (function() {
          // Check for <template> support
          if ('content' in document.createElement('template')) {
            const tmpl = document.createElement('template')

            // Create the web component's template
            // featuring a <slot> for the Light DOM content
            tmpl.innerHTML = `
              <h2>
                <button aria-expanded="false">
                  <svg aria-hidden="true" focusable="false" viewBox="0 0 10 10">
                    <rect class="vert" height="8" width="2" y="1" x="4"/>
                    <rect height="2" width="8" y="4" x="1"/>
                  </svg>
                </button>
              </h2>
              <div class="content" hidden>
                <slot></slot>
              </div>
              <style>
                h2 {
                  margin: 0;
                }

                h2 button {
                  all: inherit;
                  box-sizing: border-box;
                  display: flex;
                  justify-content: space-between;
                  width: 100%;
                  padding: 0.5em 0;
                }

                h2 button:focus svg {
                  outline: 2px solid;
                }

                button svg {
                  height: 1em;
                  margin-left: 0.5em;
                }

                [aria-expanded="true"] .vert {
                  display: none;
                }

                [aria-expanded] rect {
                  fill: currentColor;
                }
              </style>
            `
            // Check for latest Shadow DOM syntax support
            if (document.head.attachShadow) {
              class ToggleSection extends HTMLElement {
                constructor() {
                  super()

                  // Make the host element a region
                  this.setAttribute('role', 'region')

                  // Create a `shadowRoot` and populate from template
                  this.attachShadow({ mode: 'open' })
                  this.shadowRoot.appendChild(tmpl.content.cloneNode(true))

                  // Assign the toggle button
                  this.btn = this.shadowRoot.querySelector('h2 button')

                  // Get the first element in Light DOM
                  const oldHeading = this.querySelector(':first-child')
                  // and cast its heading level (which should, but may not, exist)
                  let level = parseInt(oldHeading.tagName.substr(1))
                  // Then take its `id` (may be null)
                  let id = oldHeading.id

                  // Get the Shadow DOM <h2>
                  this.heading = this.shadowRoot.querySelector('h2')

                  // If `id` exists, apply it
                  if (id) {
                    this.heading.id = id
                  }

                  // If there is no level, there is no heading.
                  // Add a warning.
                  if (!level) {
                    console.warn('The first element inside each <toggle-section> should be a heading of an appropriate level.')
                  }

                  // If the level is a real integer but not 2
                  // set `aria-level` accordingly
                  if (level && level !== 2) {
                    this.heading.setAttribute('aria-level', level)
                  }

                  // Add the Light DOM heading label to the innerHTML of the toggle button
                  // and remove the now unwanted Light DOM heading
                  this.btn.innerHTML = oldHeading.textContent + this.btn.innerHTML
                  oldHeading.parentNode.removeChild(oldHeading)

                  // The main state switching function
                  this.switchState = () => {
                    let expanded = this.getAttribute('open') === 'true' || false

                    // Toggle `aria-expanded`
                    this.btn.setAttribute('aria-expanded', expanded)
                    // Toggle the `.content` element's visibility
                    this.shadowRoot.querySelector('.content').hidden = !expanded
                  }

                  this.btn.onclick = () => {
                    // Change the component's `open` attribute value on click
                    let open = this.getAttribute('open') === 'true' || false
                    this.setAttribute('open', open ? 'false' : 'true')

                    // Update the hash if the collapsible section's
                    // heading has an `id` and we are opening, not closing
                    if (this.heading.id && !open) {
                      history.pushState(null, null, '#' + this.heading.id)
                    }
                  }
                }

                connectedCallback() {
                  if (window.location.hash.substr(1) === this.heading.id) {
                    this.setAttribute('open', 'true')
                    this.btn.focus()
                  }
                }

                // Identify just the `open` attribute as an observed attribute
                static get observedAttributes() {
                  return ['open']
                }

                // When `open` changes value, execute switchState()
                attributeChangedCallback(name) {
                  if (name === 'open') {
                    this.switchState()
                  }
                }
              }

              // Add our new custom element to the window for use
              window.customElements.define('toggle-section', ToggleSection)

              // Define the expand/collapse all template
              const buttons = document.createElement('div')
              buttons.innerHTML = `
                <ul class="controls" aria-label="section controls">
                  <li><button id="expand">expand all</button></li>
                  <li><button id="collapse">collapse all</button></li>
                </ul>
                `

              // Get the first `toggle-section` on the page
              // and all toggle sections as a node list
              const first = document.querySelector('toggle-section')
              const all = document.querySelectorAll('toggle-section')

              // Insert the button controls before the first <toggle-section>
              first.parentNode.insertBefore(buttons, first)

              // Place the click on the parent <ul>...
              buttons.addEventListener('click', (e) => {
                // ...then determine which button was the target
                let expand = e.target.id === 'expand' ? true : false

                // Iterate over the toggle sections to switch
                // each one's state uniformly
                Array.prototype.forEach.call(all, (t) => {
                  t.setAttribute('open', expand)
                })
              })
            }
          }
        })();
        (function() {
          // Check for <template> support
          if ('content' in document.createElement('template')) {
            const tmpl = document.createElement('template')

            // Create the web component's template
            // featuring a <slot> for the Light DOM content
            tmpl.innerHTML = `
              <h2>
                <button aria-expanded="false">
                  <svg aria-hidden="true" focusable="false" viewBox="0 0 10 10">
                    <rect class="vert" height="8" width="2" y="1" x="4"/>
                    <rect height="2" width="8" y="4" x="1"/>
                  </svg>
                </button>
              </h2>
              <div class="content" hidden>
                <slot></slot>
              </div>
              <style>
                h2 {
                  margin: 0;
                }

                h2 button {
                  all: inherit;
                  box-sizing: border-box;
                  display: flex;
                  justify-content: space-between;
                  width: 100%;
                  padding: 0.5em 0;
                }

                h2 button:focus svg {
                  outline: 2px solid;
                }

                button svg {
                  height: 1em;
                  margin-left: 0.5em;
                }

                [aria-expanded="true"] .vert {
                  display: none;
                }

                [aria-expanded] rect {
                  fill: currentColor;
                }
              </style>
            `
            // Check for latest Shadow DOM syntax support
            if (document.head.attachShadow) {
              class ToggleSection extends HTMLElement {
                constructor() {
                  super()

                  // Make the host element a region
                  this.setAttribute('role', 'region')

                  // Create a `shadowRoot` and populate from template
                  this.attachShadow({ mode: 'open' })
                  this.shadowRoot.appendChild(tmpl.content.cloneNode(true))

                  // Assign the toggle button
                  this.btn = this.shadowRoot.querySelector('h2 button')

                  // Get the first element in Light DOM
                  const oldHeading = this.querySelector(':first-child')
                  // and cast its heading level (which should, but may not, exist)
                  let level = parseInt(oldHeading.tagName.substr(1))
                  // Then take its `id` (may be null)
                  let id = oldHeading.id

                  // Get the Shadow DOM <h2>
                  this.heading = this.shadowRoot.querySelector('h2')

                  // If `id` exists, apply it
                  if (id) {
                    this.heading.id = id
                  }

                  // If there is no level, there is no heading.
                  // Add a warning.
                  if (!level) {
                    console.warn('The first element inside each <toggle-section> should be a heading of an appropriate level.')
                  }

                  // If the level is a real integer but not 2
                  // set `aria-level` accordingly
                  if (level && level !== 2) {
                    this.heading.setAttribute('aria-level', level)
                  }

                  // Add the Light DOM heading label to the innerHTML of the toggle button
                  // and remove the now unwanted Light DOM heading
                  this.btn.innerHTML = oldHeading.textContent + this.btn.innerHTML
                  oldHeading.parentNode.removeChild(oldHeading)

                  // The main state switching function
                  this.switchState = () => {
                    let expanded = this.getAttribute('open') === 'true' || false

                    // Toggle `aria-expanded`
                    this.btn.setAttribute('aria-expanded', expanded)
                    // Toggle the `.content` element's visibility
                    this.shadowRoot.querySelector('.content').hidden = !expanded
                  }

                  this.btn.onclick = () => {
                    // Change the component's `open` attribute value on click
                    let open = this.getAttribute('open') === 'true' || false
                    this.setAttribute('open', open ? 'false' : 'true')

                    // Update the hash if the collapsible section's
                    // heading has an `id` and we are opening, not closing
                    if (this.heading.id && !open) {
                      history.pushState(null, null, '#' + this.heading.id)
                    }
                  }
                }

                connectedCallback() {
                  if (window.location.hash.substr(1) === this.heading.id) {
                    this.setAttribute('open', 'true')
                    this.btn.focus()
                  }
                }

                // Identify just the `open` attribute as an observed attribute
                static get observedAttributes() {
                  return ['open']
                }

                // When `open` changes value, execute switchState()
                attributeChangedCallback(name) {
                  if (name === 'open') {
                    this.switchState()
                  }
                }
              }

              // Add our new custom element to the window for use
              window.customElements.define('toggle-section-2', ToggleSection)

              // Define the expand/collapse all template
              const buttons = document.createElement('div')
              buttons.innerHTML = `
                <ul class="controls" aria-label="section controls">
                  <li><button id="expand">expand all</button></li>
                  <li><button id="collapse">collapse all</button></li>
                </ul>
                `

              // Get the first `toggle-section` on the page
              // and all toggle sections as a node list
              const first = document.querySelector('toggle-section-2')
              const all = document.querySelectorAll('toggle-section-2')

              // Insert the button controls before the first <toggle-section>
              first.parentNode.insertBefore(buttons, first)

              // Place the click on the parent <ul>...
              buttons.addEventListener('click', (e) => {
                // ...then determine which button was the target
                let expand = e.target.id === 'expand' ? true : false

                // Iterate over the toggle sections to switch
                // each one's state uniformly
                Array.prototype.forEach.call(all, (t) => {
                  t.setAttribute('open', expand)
                })
              })
            }
          }
        })();
      </script>
      <p>
        The projection on the left is inspired by a similar projection done by
        Perez et al.  <d-cite key="perez2018film"></d-cite> for their visual
        reasoning model trained on CLEVR and shows how questions group by
        question type.
      </p>
      <p>
        The projection on the right is inspired by a similar projection done by
        Ghiasi et al. <d-cite key="ghiasi2017exploring"></d-cite> for their
        style transfer network. The projection does not cluster artists as
        neatly as the projection on the left, but this is to be expected, given
        that an artist's style may vary widely over time. However, we can still detect interesting patterns in the
        projection: note for instance the isolated cluster (circled in the figure) in which
        paintings by Ivan Shishkin and Rembrandt are aggregated. While these two painters
        exhibit fairly different styles, the cluster is a grouping of their sketches.
      </p>
      <figure class="l-body" id="style-explained-diagram">
        <svg viewBox="0 0 600 270" xmlns="http://www.w3.org/2000/svg">
          <image x="0" y="0" height="200" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/woman-with-a-pink.jpg"/>
          <text x="0" y="210" dy="1em" class="figure-text">
            <tspan>
              Rembrandt's <tspan style="font-style: italic;">Woman</tspan>
            </tspan>
            <tspan x="0" dy="1.5em">
              <tspan style="font-style: italic;">with a Pink</tspan>.
            </tspan>
          </text>
          <image x="200" y="0" height="200" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/a-woman-with-a-boy-in-the-forest.jpg"/>
          <text x="200" y="210" dy="1em" class="figure-text">
            <tspan>
              Shishkin's <tspan style="font-style: italic;">Woman with</tspan>
            </tspan>
            <tspan x="200" dy="1.5em">
              <tspan style="font-style: italic;">a Boy in the forest</tspan>.
            </tspan>
          </text>
          <image x="400" y="0" height="160" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/abraham-and-isaac.jpg"/>
          <image x="440" y="40" height="160" style="clip-path: inset(0 0 0 0 round 6px);" xlink:href="assets/pines-on-the-beach.jpg"/>
          <text x="400" y="210" dy="1em" class="figure-text">
            <tspan>
              Sketches by Rembrandt and
            </tspan>
            <tspan x="400" dy="1.5em">
              Shishkin found in the same
            </tspan>
            <tspan x="400" dy="1.5em">
              t-SNE cluster.
            </tspan>
          </text>
        </svg>
      </figure>
      <p>
        To summarize, the way neural networks learn to use FiLM layers seems to
        vary task to task, input to input, and even feature to
        feature; there does not seem to be a single mechanism by which the
        network uses FiLM to condition computation.
        This flexibility may explain why FiLM-related methods have been
        successful across such a wide variety of domains.
        It also appears that the learned FiLM representation contains
        a lot of interesting task information which helps explain why it is
        possible to perform task interpolations, analogies, and analysis using
        this representation.
      </p>
      <p>
        Precisely how changes on the feature level
        alone are able to compound into large and meaningful modulations of the
        FiLMed network is still an open question, and hopefully we will gain a
        better idea in the future.
        For now, though, it is a question evokes the even grander mystery of
        how neural networks in general compound simple operations like
        matrix multiplications and element-wise non-linearities into
        semantically meaningful transformations.
      </p>
    </d-article>

    <d-appendix>
      <h3 id="bibliographic-notes">Bibliographic Notes</h3>
      <p>
          Multiplicative interactions have succeeded on various tasks,
          ever since they were introduced in vision as "mapping units"
          <d-cite key="hinton1981a"></d-cite> and "dynamic mappings"
          <d-cite key="vonderMalsburg1994the"></d-cite> around 40 years ago.
          These tasks include
          Character-level Language Modeling<d-cite key="sutskever2011generating"></d-cite>,
          Image Denoising<d-cite key="tang2012boltzmann"></d-cite>,
          Pose Estimation<d-cite key="taylor2009factored"></d-cite>,
          Tracking<d-cite key="ross2006combining,denil2012learning"></d-cite>,
          Action Recognition<d-cite key="le2011learning,taylor2010convolutional"></d-cite>,
          and, more generally, tasks involving relating or matching inputs,
          such as from different modalities or points in time.
          <d-cite key="memisevic2013learning"></d-cite>
      </p>
      <p>
        Many models lie on the spectrum between FiLM and Hypernetworks:
      </p>
      <ul>
        <li>
          Adaptive CNN <d-cite key="kang2017incorporating"></d-cite>
          predicts the value of several of the model's convolution filters as
          a function of auxiliary inputs like camera perspective, level of
          noise, etc. The resulting convolution filters turn out to be very
          effective in difficult vision tasks such as crowd counting or image
          deblurring.
        </li>
        <li>
          Residual Adapters <d-cite key="rebuffi2017residualadapters"></d-cite>
          also propose to predict entire convolutional filters conditioned on
          the visual recognition domain they are operating in.
        </li>
        <li>
          In the zero-shot/one-shot learning setting, the model proposed by Ba
          et al. <d-cite key="lei2015predicting"></d-cite> predicts
          convolutional filters and classifiers weights based on textual
          descriptions of object classes.
        </li>
        <li>
          In the reinforcement learning setting, the model proposed by Oh et
          al. <d-cite key="oh2017zero"></d-cite> computes the parameters of a
          policy-convolutional network conditioned on the task description.
        </li>
      </ul>
      <p>
        Bilinear models were first introduced in the vision community by
        Tenenbaum et al. <d-cite key="tenenbaum1997separating"></d-cite> to
        better untangle latent perceptual factors. The authors wanted to
        separate the image style from its content, arguing that classic linear
        models were not rich enough to extract such complex interaction. They
        demonstrate the effectiveness of their approach by applying it to
        spoken vowel identification or zero-shot font classification. Notable
        applications include:
      </p>
      <ul>
        <li>
          Chuang et al. <d-cite key="chuang2002facial"></d-cite> perform facial
          animation using bilinear transformations by separating key facial
          features (the style) from visual emotions (the content). This allows
          to modify a sequence originally recorded with a happy expression so
          that the subject appears to be speaking with an angry or neutral
          expression.
        </li>
        <li>
          Chu et al. <d-cite key="chu2009personalized"></d-cite> and Yang et
          al. <d-cite key="yang2011like"></d-cite> apply bilinear models to
          recommendation systems by extracting user and item information in
          various settings. More generally, recommendation systems rely heavily
          on matrix factorization methods <d-cite key="koren2009matrix"></d-cite>,
          which can be viewed as a bilinear model in which one of the latent
          vectors is kept fixed<d-cite key="tenenbaum1997separating"></d-cite>.
        </li>
        <li>
          More recently, bilinear models have inspired new neural architecture
          in visual recognition <d-cite key="lin2015bilinear"></d-cite>, video
          action recognition <d-cite key="feichtenhofer2016convolutional"></d-cite>,
          and visual question-answering<d-cite key="fukui2016multimodal"></d-cite>.
        </li>
      </ul>
      <h3>Acknowledgements</h3>
      <p>
        This article would be nowhere near where it is today without the honest
        and constructive feedback we received from various people across several
        organizations. We would like to thank Chris Olah from the Distill
        editorial team for being so generous with his time and advice. We would
        also like to thank Archy de Berker, Xavier Snelgrove, Pedro Oliveira
        Pinheiro, Alexei Nordell-Markovits, Masha Krol, and Minh Dao from
        Element AI; Roland Memisevic from TwentyBN; Dzmitry Bahdanau from MILA;
        Ameesh Shah from Rice; Olivier Pietquin and Jon Shlens from Goolgle
        Brain; and Jérémie Mary from Criteo.
      </p>
      <d-footnote-list></d-footnote-list>
      <d-citation-list></d-citation-list>
    </d-appendix>

    <d-bibliography src="bibliography.bib"></d-bibliography>
  </body>
</html>
